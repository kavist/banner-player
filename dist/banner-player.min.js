(function () {var kb=this;var _={};function Fd(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function Ua(e,i){for(var t=0;t<i.length;t++){var r=i[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ed(e,i,t){return i&&Ua(e.prototype,i),t&&Ua(e,t),e}function v(e,i,t){return i in e?Object.defineProperty(e,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[i]=t,e}function Dd(e,i,t){var r;return function(){var a=this,n=arguments,s=t&&!r;clearTimeout(r),r=setTimeout(function(){r=null,t||e.apply(a,n)},i),s&&e.apply(a,n)}}var x={};Object.defineProperty(x,"__esModule",{value:!0});var Bd=Math.PI/180;function zd(){return"undefined"!=typeof window&&("[object Window]"==={}.toString.call(window)||"[object global]"==={}.toString.call(window))}var yd=function(e){var r=e.indexOf("msie ");if(r>0)return parseInt(e.substring(r+5,e.indexOf(".",r)),10);if(e.indexOf("trident/")>0){var o=e.indexOf("rv:");return parseInt(e.substring(o+3,e.indexOf(".",o)),10)}var t=e.indexOf("edge/");return t>0&&parseInt(e.substring(t+5,e.indexOf(".",t)),10)},qa=function(e){var r=e.toLowerCase(),o=/(chrome)[ \/]([\w.]+)/.exec(r)||/(webkit)[ \/]([\w.]+)/.exec(r)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(r)||/(msie) ([\w.]+)/.exec(r)||r.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(r)||[],t=!!e.match(/Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|IEMobile/i),n=!!e.match(/IEMobile/i);return{browser:o[1]||"",version:o[2]||"0",isIE:yd(r),mobile:t,ieMobile:n}};x._parseUA=qa;var i="undefined"!=typeof kb?kb:"undefined"!=typeof window?window:"undefined"!=typeof WorkerGlobalScope?self:{};x.glob=i;var d={_global:i,version:"4.0.18",isBrowser:zd(),isUnminified:/param/.test(function(e){}.toString()),dblClickWindow:400,getAngle:function(e){return d.angleDeg?e*Bd:e},enableTrace:!1,_pointerEventsEnabled:!1,hitOnDragEnabled:!1,captureTouchEventsEnabled:!1,listenClickTap:!1,inDblClickWindow:!1,pixelRatio:void 0,dragDistance:3,angleDeg:!0,showWarnings:!0,dragButtons:[0,1],isDragging:function(){return d.DD.isDragging},isDragReady:function(){return!!d.DD.node},UA:qa(i.navigator&&i.navigator.userAgent||""),document:i.document,_injectGlobal:function(e){i.Konva=e},_parseUA:qa};x.Konva=d;var Z={};x._NODES_REGISTRY=Z;var J=function(e){Z[e.prototype.getClassName()]=e,d[e.prototype.getClassName()]=e};x._registerNode=J;var P={};Object.defineProperty(P,"__esModule",{value:!0});var X=function(){function t(){}return t.toCollection=function(r){var e,n=new t,o=r.length;for(e=0;e<o;e++)n.push(r[e]);return n},t._mapMethod=function(r){t.prototype[r]=function(){var t,e=this.length,n=[].slice.call(arguments);for(t=0;t<e;t++)this[t][r].apply(this[t],n);return this}},t.mapMethods=function(r){var e=r.prototype;for(var n in e)t._mapMethod(n)},t}(),h=X;P.Collection=h,X.prototype=[],X.prototype.each=function(t){for(var r=0;r<this.length;r++)t(this[r],r)},X.prototype.toArray=function(){var t,r=[],e=this.length;for(t=0;t<e;t++)r.push(this[t]);return r};var vd=function(){function t(t){void 0===t&&(t=[1,0,0,1,0,0]),this.m=t&&t.slice()||[1,0,0,1,0,0]}return t.prototype.copy=function(){return new t(this.m)},t.prototype.point=function(t){var r=this.m;return{x:r[0]*t.x+r[2]*t.y+r[4],y:r[1]*t.x+r[3]*t.y+r[5]}},t.prototype.translate=function(t,r){return this.m[4]+=this.m[0]*t+this.m[2]*r,this.m[5]+=this.m[1]*t+this.m[3]*r,this},t.prototype.scale=function(t,r){return this.m[0]*=t,this.m[1]*=t,this.m[2]*=r,this.m[3]*=r,this},t.prototype.rotate=function(t){var r=Math.cos(t),e=Math.sin(t),n=this.m[0]*r+this.m[2]*e,o=this.m[1]*r+this.m[3]*e,i=this.m[0]*-e+this.m[2]*r,a=this.m[1]*-e+this.m[3]*r;return this.m[0]=n,this.m[1]=o,this.m[2]=i,this.m[3]=a,this},t.prototype.getTranslation=function(){return{x:this.m[4],y:this.m[5]}},t.prototype.skew=function(t,r){var e=this.m[0]+this.m[2]*r,n=this.m[1]+this.m[3]*r,o=this.m[2]+this.m[0]*t,i=this.m[3]+this.m[1]*t;return this.m[0]=e,this.m[1]=n,this.m[2]=o,this.m[3]=i,this},t.prototype.multiply=function(t){var r=this.m[0]*t.m[0]+this.m[2]*t.m[1],e=this.m[1]*t.m[0]+this.m[3]*t.m[1],n=this.m[0]*t.m[2]+this.m[2]*t.m[3],o=this.m[1]*t.m[2]+this.m[3]*t.m[3],i=this.m[0]*t.m[4]+this.m[2]*t.m[5]+this.m[4],a=this.m[1]*t.m[4]+this.m[3]*t.m[5]+this.m[5];return this.m[0]=r,this.m[1]=e,this.m[2]=n,this.m[3]=o,this.m[4]=i,this.m[5]=a,this},t.prototype.invert=function(){var t=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),r=this.m[3]*t,e=-this.m[1]*t,n=-this.m[2]*t,o=this.m[0]*t,i=t*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),a=t*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=r,this.m[1]=e,this.m[2]=n,this.m[3]=o,this.m[4]=i,this.m[5]=a,this},t.prototype.getMatrix=function(){return this.m},t.prototype.setAbsolutePosition=function(t,r){var e=this.m[0],n=this.m[1],o=this.m[2],i=this.m[3],a=this.m[4],s=(e*(r-this.m[5])-n*(t-a))/(e*i-n*o),c=(t-a-o*s)/e;return this.translate(c,s)},t}(),ca=vd;P.Transform=ca;var ud="[object Array]",sd="[object Number]",rd="[object String]",qd="[object Boolean]",pd=Math.PI/180,nd=180/Math.PI,va="#",md="",ld="0",jd="Konva warning: ",Ab="Konva error: ",ed="rgb(",za={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},dd=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/,Aa=[],b={_isElement:function(t){return!(!t||1!=t.nodeType)},_isFunction:function(t){return!!(t&&t.constructor&&t.call&&t.apply)},_isPlainObject:function(t){return!!t&&t.constructor===Object},_isArray:function(t){return Object.prototype.toString.call(t)===ud},_isNumber:function(t){return Object.prototype.toString.call(t)===sd&&!isNaN(t)&&isFinite(t)},_isString:function(t){return Object.prototype.toString.call(t)===rd},_isBoolean:function(t){return Object.prototype.toString.call(t)===qd},isObject:function(t){return t instanceof Object},isValidSelector:function(t){if("string"!=typeof t)return!1;var r=t[0];return"#"===r||"."===r||r===r.toUpperCase()},_sign:function(t){return 0===t?0:t>0?1:-1},requestAnimFrame:function(t){Aa.push(t),1===Aa.length&&requestAnimationFrame(function(){var t=Aa;Aa=[],t.forEach(function(t){t()})})},createCanvasElement:function(){var t=document.createElement("canvas");try{t.style=t.style||{}}catch(r){}return t},createImageElement:function(){return document.createElement("img")},_isInDocument:function(t){for(;t=t.parentNode;)if(t==document)return!0;return!1},_simplifyArray:function(t){var r,e,n=[],o=t.length,i=b;for(r=0;r<o;r++)e=t[r],i._isNumber(e)?e=Math.round(1e3*e)/1e3:i._isString(e)||(e=e.toString()),n.push(e);return n},_urlToImage:function(t,r){var e=new i.Image;e.onload=function(){r(e)},e.src=t},_rgbToHex:function(t,r,e){return((1<<24)+(t<<16)+(r<<8)+e).toString(16).slice(1)},_hexToRgb:function(t){t=t.replace(va,md);var r=parseInt(t,16);return{r:r>>16&255,g:r>>8&255,b:255&r}},getRandomColor:function(){for(var t=(16777215*Math.random()<<0).toString(16);t.length<6;)t=ld+t;return va+t},get:function(t,r){return void 0===t?r:t},getRGB:function(t){var r;return t in za?{r:(r=za[t])[0],g:r[1],b:r[2]}:t[0]===va?this._hexToRgb(t.substring(1)):t.substr(0,4)===ed?(r=dd.exec(t.replace(/ /g,"")),{r:parseInt(r[1],10),g:parseInt(r[2],10),b:parseInt(r[3],10)}):{r:0,g:0,b:0}},colorToRGBA:function(t){return t=t||"black",b._namedColorToRBA(t)||b._hex3ColorToRGBA(t)||b._hex6ColorToRGBA(t)||b._rgbColorToRGBA(t)||b._rgbaColorToRGBA(t)||b._hslColorToRGBA(t)},_namedColorToRBA:function(t){var r=za[t.toLowerCase()];return r?{r:r[0],g:r[1],b:r[2],a:1}:null},_rgbColorToRGBA:function(t){if(0===t.indexOf("rgb(")){var r=(t=t.match(/rgb\(([^)]+)\)/)[1]).split(/ *, */).map(Number);return{r:r[0],g:r[1],b:r[2],a:1}}},_rgbaColorToRGBA:function(t){if(0===t.indexOf("rgba(")){var r=(t=t.match(/rgba\(([^)]+)\)/)[1]).split(/ *, */).map(Number);return{r:r[0],g:r[1],b:r[2],a:r[3]}}},_hex6ColorToRGBA:function(t){if("#"===t[0]&&7===t.length)return{r:parseInt(t.slice(1,3),16),g:parseInt(t.slice(3,5),16),b:parseInt(t.slice(5,7),16),a:1}},_hex3ColorToRGBA:function(t){if("#"===t[0]&&4===t.length)return{r:parseInt(t[1]+t[1],16),g:parseInt(t[2]+t[2],16),b:parseInt(t[3]+t[3],16),a:1}},_hslColorToRGBA:function(t){if(/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.test(t)){var r=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(t),e=(r[0],r.slice(1)),n=Number(e[0])/360,o=Number(e[1])/100,i=Number(e[2])/100,a=void 0,s=void 0,c=void 0;if(0===o)return c=255*i,{r:Math.round(c),g:Math.round(c),b:Math.round(c),a:1};for(var l=2*i-(a=i<.5?i*(1+o):i+o-i*o),u=[0,0,0],h=0;h<3;h++)(s=n+1/3*-(h-1))<0&&s++,s>1&&s--,c=6*s<1?l+6*(a-l)*s:2*s<1?a:3*s<2?l+(a-l)*(2/3-s)*6:l,u[h]=255*c;return{r:Math.round(u[0]),g:Math.round(u[1]),b:Math.round(u[2]),a:1}}},haveIntersection:function(t,r){return!(r.x>t.x+t.width||r.x+r.width<t.x||r.y>t.y+t.height||r.y+r.height<t.y)},cloneObject:function(t){var r={};for(var e in t)this._isPlainObject(t[e])?r[e]=this.cloneObject(t[e]):this._isArray(t[e])?r[e]=this.cloneArray(t[e]):r[e]=t[e];return r},cloneArray:function(t){return t.slice(0)},_degToRad:function(t){return t*pd},_radToDeg:function(t){return t*nd},_capitalize:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},throw:function(t){throw new Error(Ab+t)},error:function(t){console.error(Ab+t)},warn:function(t){d.showWarnings&&console.warn(jd+t)},extend:function(t,r){function e(){this.constructor=t}e.prototype=r.prototype;var n=t.prototype;for(var o in t.prototype=new e,n)n.hasOwnProperty(o)&&(t.prototype[o]=n[o]);t.__super__=r.prototype,t.super=r},_getControlPoints:function(t,r,e,n,o,i,a){var s=Math.sqrt(Math.pow(e-t,2)+Math.pow(n-r,2)),c=Math.sqrt(Math.pow(o-e,2)+Math.pow(i-n,2)),l=a*s/(s+c),u=a*c/(s+c);return[e-l*(o-t),n-l*(i-r),e+u*(o-t),n+u*(i-r)]},_expandPoints:function(t,r){var e,n,o=t.length,i=[];for(e=2;e<o-2;e+=2)n=b._getControlPoints(t[e-2],t[e-1],t[e],t[e+1],t[e+2],t[e+3],r),i.push(n[0]),i.push(n[1]),i.push(t[e]),i.push(t[e+1]),i.push(n[2]),i.push(n[3]);return i},each:function(t,r){for(var e in t)r(e,t[e])},_inRange:function(t,r,e){return r<=t&&t<e},_getProjectionToSegment:function(t,r,e,n,o,i){var a,s,c,l=(t-e)*(t-e)+(r-n)*(r-n);if(0==l)a=t,s=r,c=(o-e)*(o-e)+(i-n)*(i-n);else{var u=((o-t)*(e-t)+(i-r)*(n-r))/l;u<0?(a=t,s=r,c=(t-o)*(t-o)+(r-i)*(r-i)):u>1?(a=e,s=n,c=(e-o)*(e-o)+(n-i)*(n-i)):c=((a=t+u*(e-t))-o)*(a-o)+((s=r+u*(n-r))-i)*(s-i)}return[a,s,c]},_getProjectionToLine:function(t,r,e){var n=b.cloneObject(t),o=Number.MAX_VALUE;return r.forEach(function(i,a){if(e||a!==r.length-1){var s=r[(a+1)%r.length],c=b._getProjectionToSegment(i.x,i.y,s.x,s.y,t.x,t.y),l=c[0],u=c[1],h=c[2];h<o&&(n.x=l,n.y=u,o=h)}}),n},_prepareArrayForTween:function(t,r,e){var n,o=[],i=[];if(t.length>r.length){var a=r;r=t,t=a}for(n=0;n<t.length;n+=2)o.push({x:t[n],y:t[n+1]});for(n=0;n<r.length;n+=2)i.push({x:r[n],y:r[n+1]});var s=[];return i.forEach(function(t){var r=b._getProjectionToLine(t,o,e);s.push(r.x),s.push(r.y)}),s},_prepareToStringify:function(t){var r;for(var e in t.visitedByCircularReferenceRemoval=!0,t)if(t.hasOwnProperty(e)&&t[e]&&"object"==typeof t[e])if(r=Object.getOwnPropertyDescriptor(t,e),t[e].visitedByCircularReferenceRemoval||b._isElement(t[e])){if(!r.configurable)return null;delete t[e]}else if(null===b._prepareToStringify(t[e])){if(!r.configurable)return null;delete t[e]}return delete t.visitedByCircularReferenceRemoval,t},_assign:function(t,r){for(var e in r)t[e]=r[e];return t},_getFirstPointerId:function(t){return t.touches?t.changedTouches[0].identifier:999}};P.Util=b;var l={};Object.defineProperty(l,"__esModule",{value:!0});function o(t){return b._isString(t)?"\""+t+"\"":"[object Number]"===Object.prototype.toString.call(t)?t:b._isBoolean(t)?t:Object.prototype.toString.call(t)}function cd(t){return t>255?255:t<0?0:Math.round(t)}var Uc=cd;function Tc(t){return t>1?1:t<1e-4?1e-4:t}l.RGBComponent=Uc;var Sc=Tc;function Rc(){if(d.isUnminified)return function(t,r){return b._isNumber(t)||b.warn(o(t)+" is a not valid value for \""+r+"\" attribute. The value should be a number."),t}}l.alphaComponent=Sc;var e=Rc;function Qc(){if(d.isUnminified)return function(t,r){return b._isNumber(t)||"auto"===t||b.warn(o(t)+" is a not valid value for \""+r+"\" attribute. The value should be a number or \"auto\"."),t}}l.getNumberValidator=e;var ob=Qc;function Pc(){if(d.isUnminified)return function(t,r){return b._isString(t)||b.warn(o(t)+" is a not valid value for \""+r+"\" attribute. The value should be a string."),t}}l.getNumberOrAutoValidator=ob;var n=Pc;function Oc(){if(d.isUnminified)return function(t,r){return b._isFunction(t)||b.warn(o(t)+" is a not valid value for \""+r+"\" attribute. The value should be a function."),t}}l.getStringValidator=n;var Lc=Oc;function Kc(){if(d.isUnminified)return function(t,r){return b._isArray(t)?t.forEach(function(t){b._isNumber(t)||b.warn("\""+r+"\" attribute has non numeric element "+t+". Make sure that all elements are numbers.")}):b.warn(o(t)+" is a not valid value for \""+r+"\" attribute. The value should be a array of numbers."),t}}l.getFunctionValidator=Lc;var Jc=Kc;function Hc(){if(d.isUnminified)return function(t,r){return!0===t||!1===t||b.warn(o(t)+" is a not valid value for \""+r+"\" attribute. The value should be a boolean."),t}}l.getNumberArrayValidator=Jc;var r=Hc;function Gc(t){if(d.isUnminified)return function(r,a){return b.isObject(r)||b.warn(o(r)+" is a not valid value for \""+a+"\" attribute. The value should be an object with properties "+t),r}}l.getBooleanValidator=r;var Oa=Gc;l.getComponentValidator=Oa;var Pa={};Object.defineProperty(Pa,"__esModule",{value:!0});var I="get",D="set",c={addGetterSetter:function(t,r,e,a,i){this.addGetter(t,r,e),this.addSetter(t,r,a,i),this.addOverloadedGetterSetter(t,r)},addGetter:function(t,r,e){var a=I+b._capitalize(r);t.prototype[a]=t.prototype[a]||function(){var t=this.attrs[r];return void 0===t?e:t}},addSetter:function(t,r,e,a){var i=D+b._capitalize(r);t.prototype[i]||c.overWriteSetter(t,r,e,a)},overWriteSetter:function(t,r,e,a){var i=D+b._capitalize(r);t.prototype[i]=function(t){return e&&null!=t&&(t=e.call(this,t,r)),this._setAttr(r,t),a&&a.call(this),this}},addComponentsGetterSetter:function(t,r,e,a,i){var $,o,c=e.length,l=b._capitalize,n=I+l(r),d=D+l(r);t.prototype[n]=function(){var t={};for($=0;$<c;$++)t[o=e[$]]=this.getAttr(r+l(o));return t};var v=Oa(e);t.prototype[d]=function(t){var e,$=this.attrs[r];for(e in a&&(t=a.call(this,t)),v&&v.call(this,t,r),t)t.hasOwnProperty(e)&&this._setAttr(r+l(e),t[e]);return this._fireChangeEvent(r,$,t),i&&i.call(this),this},this.addOverloadedGetterSetter(t,r)},addOverloadedGetterSetter:function(t,r){var e=b._capitalize(r),a=D+e,i=I+e;t.prototype[r]=function(){return arguments.length?(this[a](arguments[0]),this):this[i]()}},addDeprecatedGetterSetter:function(t,r,e,a){b.error("Adding deprecated "+r);var i=I+b._capitalize(r),$=r+" property is deprecated and will be removed soon. Look at Konva change log for more information.";t.prototype[i]=function(){b.error($);var t=this.attrs[r];return void 0===t?e:t},this.addSetter(t,r,a,function(){b.error($)}),this.addOverloadedGetterSetter(t,r)},backCompat:function(t,r){b.each(r,function(r,e){var a=t.prototype[e],i=I+b._capitalize(r),$=D+b._capitalize(r);function o(){a.apply(this,arguments),b.error("\""+r+"\" method is deprecated and will be removed soon. Use \"\""+e+"\" instead.")}t.prototype[r]=o,t.prototype[i]=o,t.prototype[$]=o})},afterSetFilter:function(){this._filterUpToDate=!1}};Pa.Factory=c;var s={},Va=s&&s.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function r(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(s,"__esModule",{value:!0});var Wa=",",Gd="(",Ec=")",Dc="([",zc="])",ec=";",dc="()",cc="=",hb=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","ellipse","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"],bc=["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","imageSmoothingEnabled"],ac=100,$=function(){function t(t){this.canvas=t,this._context=t._canvas.getContext("2d"),d.enableTrace&&(this.traceArr=[],this._enableTrace())}return t.prototype.fillShape=function(t){t.getFillEnabled()&&this._fill(t)},t.prototype._fill=function(t){},t.prototype.strokeShape=function(t){t.getStrokeEnabled()&&this._stroke(t)},t.prototype._stroke=function(t){},t.prototype.fillStrokeShape=function(t){t.getFillEnabled()&&this._fill(t),t.getStrokeEnabled()&&this._stroke(t)},t.prototype.getTrace=function(t){var e,o,r,i,a=this.traceArr,n=a.length,s="";for(e=0;e<n;e++)(r=(o=a[e]).method)?(i=o.args,s+=r,t?s+=dc:b._isArray(i[0])?s+=Dc+i.join(Wa)+zc:s+=Gd+i.join(Wa)+Ec):(s+=o.property,t||(s+=cc+o.val)),s+=ec;return s},t.prototype.clearTrace=function(){this.traceArr=[]},t.prototype._trace=function(t){var e=this.traceArr;e.push(t),e.length>=ac&&e.shift()},t.prototype.reset=function(){var t=this.getCanvas().getPixelRatio();this.setTransform(1*t,0,0,1*t,0,0)},t.prototype.getCanvas=function(){return this.canvas},t.prototype.clear=function(t){var e=this.getCanvas();t?this.clearRect(t.x||0,t.y||0,t.width||0,t.height||0):this.clearRect(0,0,e.getWidth()/e.pixelRatio,e.getHeight()/e.pixelRatio)},t.prototype._applyLineCap=function(t){var e=t.getLineCap();e&&this.setAttr("lineCap",e)},t.prototype._applyOpacity=function(t){var e=t.getAbsoluteOpacity();1!==e&&this.setAttr("globalAlpha",e)},t.prototype._applyLineJoin=function(t){var e=t.getLineJoin();e&&this.setAttr("lineJoin",e)},t.prototype.setAttr=function(t,e){this._context[t]=e},t.prototype.arc=function(t,e,o,r,i,a){this._context.arc(t,e,o,r,i,a)},t.prototype.arcTo=function(t,e,o,r,i){this._context.arcTo(t,e,o,r,i)},t.prototype.beginPath=function(){this._context.beginPath()},t.prototype.bezierCurveTo=function(t,e,o,r,i,a){this._context.bezierCurveTo(t,e,o,r,i,a)},t.prototype.clearRect=function(t,e,o,r){this._context.clearRect(t,e,o,r)},t.prototype.clip=function(){this._context.clip()},t.prototype.closePath=function(){this._context.closePath()},t.prototype.createImageData=function(t,e){var o=arguments;return 2===o.length?this._context.createImageData(t,e):1===o.length?this._context.createImageData(t):void 0},t.prototype.createLinearGradient=function(t,e,o,r){return this._context.createLinearGradient(t,e,o,r)},t.prototype.createPattern=function(t,e){return this._context.createPattern(t,e)},t.prototype.createRadialGradient=function(t,e,o,r,i,a){return this._context.createRadialGradient(t,e,o,r,i,a)},t.prototype.drawImage=function(t,e,o,r,i,a,n,s,l){var p=arguments,c=this._context;3===p.length?c.drawImage(t,e,o):5===p.length?c.drawImage(t,e,o,r,i):9===p.length&&c.drawImage(t,e,o,r,i,a,n,s,l)},t.prototype.ellipse=function(t,e,o,r,i,a,n,s){this._context.ellipse(t,e,o,r,i,a,n,s)},t.prototype.isPointInPath=function(t,e){return this._context.isPointInPath(t,e)},t.prototype.fill=function(){this._context.fill()},t.prototype.fillRect=function(t,e,o,r){this._context.fillRect(t,e,o,r)},t.prototype.strokeRect=function(t,e,o,r){this._context.strokeRect(t,e,o,r)},t.prototype.fillText=function(t,e,o){this._context.fillText(t,e,o)},t.prototype.measureText=function(t){return this._context.measureText(t)},t.prototype.getImageData=function(t,e,o,r){return this._context.getImageData(t,e,o,r)},t.prototype.lineTo=function(t,e){this._context.lineTo(t,e)},t.prototype.moveTo=function(t,e){this._context.moveTo(t,e)},t.prototype.rect=function(t,e,o,r){this._context.rect(t,e,o,r)},t.prototype.putImageData=function(t,e,o){this._context.putImageData(t,e,o)},t.prototype.quadraticCurveTo=function(t,e,o,r){this._context.quadraticCurveTo(t,e,o,r)},t.prototype.restore=function(){this._context.restore()},t.prototype.rotate=function(t){this._context.rotate(t)},t.prototype.save=function(){this._context.save()},t.prototype.scale=function(t,e){this._context.scale(t,e)},t.prototype.setLineDash=function(t){this._context.setLineDash?this._context.setLineDash(t):"mozDash"in this._context?this._context.mozDash=t:"webkitLineDash"in this._context&&(this._context.webkitLineDash=t)},t.prototype.getLineDash=function(){return this._context.getLineDash()},t.prototype.setTransform=function(t,e,o,r,i,a){this._context.setTransform(t,e,o,r,i,a)},t.prototype.stroke=function(){this._context.stroke()},t.prototype.strokeText=function(t,e,o,r){this._context.strokeText(t,e,o,r)},t.prototype.transform=function(t,e,o,r,i,a){this._context.transform(t,e,o,r,i,a)},t.prototype.translate=function(t,e){this._context.translate(t,e)},t.prototype._enableTrace=function(){var t,e,o=this,r=hb.length,i=b._simplifyArray,a=this.setAttr,n=function(t){var r,a=o[t];o[t]=function(){return e=i(Array.prototype.slice.call(arguments,0)),r=a.apply(o,arguments),o._trace({method:t,args:e}),r}};for(t=0;t<r;t++)n(hb[t]);o.setAttr=function(){a.apply(o,arguments);var t=arguments[0],e=arguments[1];"shadowOffsetX"!==t&&"shadowOffsetY"!==t&&"shadowBlur"!==t||(e/=this.canvas.getPixelRatio()),o._trace({property:t,val:e})}},t.prototype._applyGlobalCompositeOperation=function(t){var e=t.getGlobalCompositeOperation();"source-over"!==e&&this.setAttr("globalCompositeOperation",e)},t}(),_b=$;s.Context=_b,bc.forEach(function(t){Object.defineProperty($.prototype,t,{get:function(){return this._context[t]},set:function(e){this._context[t]=e}})});var $b=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Va(e,t),e.prototype._fillColor=function(t){var e=t.fill();this.setAttr("fillStyle",e),t._fillFunc(this)},e.prototype._fillPattern=function(t){var e=t.getFillPatternX(),o=t.getFillPatternY(),r=d.getAngle(t.getFillPatternRotation()),i=t.getFillPatternOffsetX(),a=t.getFillPatternOffsetY(),n=t.getFillPatternScaleX(),s=t.getFillPatternScaleY();(e||o)&&this.translate(e||0,o||0),r&&this.rotate(r),(n||s)&&this.scale(n,s),(i||a)&&this.translate(-1*i,-1*a),this.setAttr("fillStyle",t._getFillPattern()),t._fillFunc(this)},e.prototype._fillLinearGradient=function(t){var e=t._getLinearGradient();e&&(this.setAttr("fillStyle",e),t._fillFunc(this))},e.prototype._fillRadialGradient=function(t){var e=t._getRadialGradient();e&&(this.setAttr("fillStyle",e),t._fillFunc(this))},e.prototype._fill=function(t){var e=t.fill(),o=t.getFillPriority();if(e&&"color"===o)this._fillColor(t);else{var r=t.getFillPatternImage();if(r&&"pattern"===o)this._fillPattern(t);else{var i=t.getFillLinearGradientColorStops();if(i&&"linear-gradient"===o)this._fillLinearGradient(t);else{var a=t.getFillRadialGradientColorStops();a&&"radial-gradient"===o?this._fillRadialGradient(t):e?this._fillColor(t):r?this._fillPattern(t):i?this._fillLinearGradient(t):a&&this._fillRadialGradient(t)}}}},e.prototype._strokeLinearGradient=function(t){var e=t.getStrokeLinearGradientStartPoint(),o=t.getStrokeLinearGradientEndPoint(),r=t.getStrokeLinearGradientColorStops(),i=this.createLinearGradient(e.x,e.y,o.x,o.y);if(r){for(var a=0;a<r.length;a+=2)i.addColorStop(r[a],r[a+1]);this.setAttr("strokeStyle",i)}},e.prototype._stroke=function(t){var e=t.dash(),o=t.getStrokeScaleEnabled();if(t.hasStroke()){if(!o){this.save();var r=this.getCanvas().getPixelRatio();this.setTransform(r,0,0,r,0,0)}this._applyLineCap(t),e&&t.dashEnabled()&&(this.setLineDash(e),this.setAttr("lineDashOffset",t.dashOffset())),this.setAttr("lineWidth",t.strokeWidth()),t.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)"),t.getStrokeLinearGradientColorStops()?this._strokeLinearGradient(t):this.setAttr("strokeStyle",t.stroke()),t._strokeFunc(this),o||this.restore()}},e.prototype._applyShadow=function(t){var e=b,o=e.get(t.getShadowRGBA(),"black"),r=e.get(t.getShadowBlur(),5),i=e.get(t.getShadowOffset(),{x:0,y:0}),a=t.getAbsoluteScale(),n=this.canvas.getPixelRatio(),s=a.x*n,l=a.y*n;this.setAttr("shadowColor",o),this.setAttr("shadowBlur",r*Math.min(Math.abs(s),Math.abs(l))),this.setAttr("shadowOffsetX",i.x*s),this.setAttr("shadowOffsetY",i.y*l)},e}($),qb=$b;s.SceneContext=qb;var Zb=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Va(e,t),e.prototype._fill=function(t){this.save(),this.setAttr("fillStyle",t.colorKey),t._fillFuncHit(this),this.restore()},e.prototype._stroke=function(t){if(t.hasHitStroke()){var e=t.getStrokeScaleEnabled();if(!e){this.save();var o=this.getCanvas().getPixelRatio();this.setTransform(o,0,0,o,0,0)}this._applyLineCap(t);var r=t.hitStrokeWidth(),i="auto"===r?t.strokeWidth():r;this.setAttr("lineWidth",i),this.setAttr("strokeStyle",t.colorKey),t._strokeFuncHit(this),e||this.restore()}},e}($),sb=Zb;s.HitContext=sb;var t={},ub=t&&t.__extends||function(){var t=function(e,a){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(e,a)};return function(e,a){function i(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0});var vb;function Yb(){if(vb)return vb;var t=b.createCanvasElement().getContext("2d");return vb=(d._global.devicePixelRatio||1)/(t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1)}var ba=function(){function t(t){this.pixelRatio=1,this.width=0,this.height=0,this.isCache=!1;var e=(t||{}).pixelRatio||d.pixelRatio||Yb();this.pixelRatio=e,this._canvas=b.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}return t.prototype.getContext=function(){return this.context},t.prototype.getPixelRatio=function(){return this.pixelRatio},t.prototype.setPixelRatio=function(t){var e=this.pixelRatio;this.pixelRatio=t,this.setSize(this.getWidth()/e,this.getHeight()/e)},t.prototype.setWidth=function(t){this.width=this._canvas.width=t*this.pixelRatio,this._canvas.style.width=t+"px";var e=this.pixelRatio;this.getContext()._context.scale(e,e)},t.prototype.setHeight=function(t){this.height=this._canvas.height=t*this.pixelRatio,this._canvas.style.height=t+"px";var e=this.pixelRatio;this.getContext()._context.scale(e,e)},t.prototype.getWidth=function(){return this.width},t.prototype.getHeight=function(){return this.height},t.prototype.setSize=function(t,e){this.setWidth(t),this.setHeight(e)},t.prototype.toDataURL=function(t,e){try{return this._canvas.toDataURL(t,e)}catch(a){try{return this._canvas.toDataURL()}catch(i){return b.error("Unable to get data URL. "+i.message),""}}},t}(),Vb=ba;t.Canvas=Vb,c.addGetterSetter(ba,"pixelRatio",void 0,e());var Ub=function(t){function e(e){void 0===e&&(e={width:0,height:0});var a=t.call(this,e)||this;return a.context=new qb(a),a.setSize(e.width,e.height),a}return ub(e,t),e}(ba),u=Ub;t.SceneCanvas=u;var Tb=function(t){function e(e){void 0===e&&(e={width:0,height:0});var a=t.call(this,e)||this;return a.hitCanvas=!0,a.context=new sb(a),a.setSize(e.width,e.height),a}return ub(e,t),e}(ba),da=Tb;t.HitCanvas=da;var Ka={};Object.defineProperty(Ka,"__esModule",{value:!0});var g={get isDragging(){var e=!1;return g._dragElements.forEach(function(t){"dragging"===t.dragStatus&&(e=!0)}),e},justDragged:!1,get node(){var e;return g._dragElements.forEach(function(t){e=t.node}),e},_dragElements:new Map,_drag:function(e){g._dragElements.forEach(function(t,r){var n=t.node,a=n.getStage();a.setPointersPositions(e),void 0===t.pointerId&&(t.pointerId=b._getFirstPointerId(e));var o=a._changedPointerPositions.find(function(e){return e.id===t.pointerId});if(o){if("dragging"!==t.dragStatus){var d=n.dragDistance();if(Math.max(Math.abs(o.x-t.startPointerPos.x),Math.abs(o.y-t.startPointerPos.y))<d)return;if(n.startDrag({evt:e}),!n.isDragging())return}n._setDragPosition(e,t),n.fire("dragmove",{type:"dragmove",target:n,evt:e},!0)}})},_endDragBefore:function(e){g._dragElements.forEach(function(t,r){var n=t.node.getStage();if(e&&n.setPointersPositions(e),n._changedPointerPositions.find(function(e){return e.id===t.pointerId})){"dragging"!==t.dragStatus&&"stopped"!==t.dragStatus||(g.justDragged=!0,d.listenClickTap=!1,t.dragStatus="stopped");var a=t.node.getLayer()||t.node instanceof d.Stage&&t.node;a&&a.draw()}})},_endDragAfter:function(e){g._dragElements.forEach(function(t,r){"stopped"===t.dragStatus&&t.node.fire("dragend",{type:"dragend",target:t.node,evt:e},!0),"dragging"!==t.dragStatus&&g._dragElements.delete(r)})}};Ka.DD=g,d.isBrowser&&(window.addEventListener("mouseup",g._endDragBefore,!0),window.addEventListener("touchend",g._endDragBefore,!0),window.addEventListener("mousemove",g._drag),window.addEventListener("touchmove",g._drag),window.addEventListener("mouseup",g._endDragAfter,!1),window.addEventListener("touchend",g._endDragAfter,!1));var p={};Object.defineProperty(p,"__esModule",{value:!0});var O={};p.ids=O;var w={};p.names=w;var Sb=function(t,e){e&&(O[e]=t)},Ca=function(t,e){t&&O[t]===e&&delete O[t]};p._removeId=Ca;var Ra=function(t,e){e&&(w[e]||(w[e]=[]),w[e].push(t))};p._addName=Ra;var Da=function(t,e){if(t){var r=w[t];if(r){for(var a=0;a<r.length;a++){r[a]._id===e&&r.splice(a,1)}0===r.length&&delete w[t]}}};p._removeName=Da;var Q="absoluteOpacity",B="absoluteTransform",ia="absoluteScale",ja="canvas",Rb="Change",Qb="children",Pb="konva",na="listening",_a="mouseenter",ab="mouseleave",Ob="name",cb="set",db="Shape",U=" ",fb="stage",V="transform",Nb="Stage",sa="visible",jb=["id"],Mb=["xChange.konva","yChange.konva","scaleXChange.konva","scaleYChange.konva","skewXChange.konva","skewYChange.konva","rotationChange.konva","offsetXChange.konva","offsetYChange.konva","transformsEnabledChange.konva"].join(U),Lb=["scaleXChange.konva","scaleYChange.konva"].join(U),mb=new h,Hb=1,f=function(){function t(t){var e=this;this._id=Hb++,this.eventListeners={},this.attrs={},this.index=0,this.parent=null,this._cache=new Map,this._lastPos=null,this._filterUpToDate=!1,this._isUnderCache=!1,this.children=mb,this._dragEventId=null,this.setAttrs(t),this.on(Mb,function(){e._clearCache(V),e._clearSelfAndDescendantCache(B)}),this.on(Lb,function(){e._clearSelfAndDescendantCache(ia)}),this.on("visibleChange.konva",function(){e._clearSelfAndDescendantCache(sa)}),this.on("listeningChange.konva",function(){e._clearSelfAndDescendantCache(na)}),this.on("opacityChange.konva",function(){e._clearSelfAndDescendantCache(Q)})}return t.prototype.hasChildren=function(){return!1},t.prototype.getChildren=function(){return mb},t.prototype._clearCache=function(t){t?this._cache.delete(t):this._cache.clear()},t.prototype._getCache=function(t,e){var r=this._cache.get(t);return void 0===r&&(r=e.call(this),this._cache.set(t,r)),r},t.prototype._getCanvasCache=function(){return this._cache.get(ja)},t.prototype._clearSelfAndDescendantCache=function(t){this._clearCache(t),this.isCached()||this.children&&this.children.each(function(e){e._clearSelfAndDescendantCache(t)})},t.prototype.clearCache=function(){return this._cache.delete(ja),this._clearSelfAndDescendantCache(),this},t.prototype.cache=function(t){var e=t||{},r={};void 0!==e.x&&void 0!==e.y&&void 0!==e.width&&void 0!==e.height||(r=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()}));var a=e.width||r.width,i=e.height||r.height,n=e.pixelRatio,o=void 0===e.x?r.x:e.x,s=void 0===e.y?r.y:e.y,$=e.offset||0,p=e.drawBorder||!1;if(a&&i){a+=2*$,i+=2*$,o-=$,s-=$;var h=new u({pixelRatio:n,width:a,height:i}),l=new u({pixelRatio:n,width:a,height:i}),c=new da({pixelRatio:1,width:a,height:i}),d=h.getContext(),v=c.getContext();return c.isCache=!0,this._cache.delete("canvas"),this._filterUpToDate=!1,!1===e.imageSmoothingEnabled&&(h.getContext()._context.imageSmoothingEnabled=!1,l.getContext()._context.imageSmoothingEnabled=!1,c.getContext()._context.imageSmoothingEnabled=!1),d.save(),v.save(),d.translate(-o,-s),v.translate(-o,-s),this._isUnderCache=!0,this._clearSelfAndDescendantCache(Q),this._clearSelfAndDescendantCache(ia),this.drawScene(h,this,!0),this.drawHit(c,this,!0),this._isUnderCache=!1,d.restore(),v.restore(),p&&(d.save(),d.beginPath(),d.rect(0,0,a,i),d.closePath(),d.setAttr("strokeStyle","red"),d.setAttr("lineWidth",5),d.stroke(),d.restore()),this._cache.set(ja,{scene:h,filter:l,hit:c,x:o,y:s}),this}b.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.")},t.prototype.isCached=function(){return this._cache.has("canvas")},t.prototype.getClientRect=function(t){throw new Error("abstract \"getClientRect\" method call")},t.prototype._transformedRect=function(t,e){var r,a,i,n,o=[{x:t.x,y:t.y},{x:t.x+t.width,y:t.y},{x:t.x+t.width,y:t.y+t.height},{x:t.x,y:t.y+t.height}],s=this.getAbsoluteTransform(e);return o.forEach(function(t){var e=s.point(t);void 0===r&&(r=i=e.x,a=n=e.y),r=Math.min(r,e.x),a=Math.min(a,e.y),i=Math.max(i,e.x),n=Math.max(n,e.y)}),{x:r,y:a,width:i-r,height:n-a}},t.prototype._drawCachedSceneCanvas=function(t){t.save(),t._applyOpacity(this),t._applyGlobalCompositeOperation(this);var e=this._getCanvasCache();t.translate(e.x,e.y);var r=this._getCachedSceneCanvas(),a=r.pixelRatio;t.drawImage(r._canvas,0,0,r.width/a,r.height/a),t.restore()},t.prototype._drawCachedHitCanvas=function(t){var e=this._getCanvasCache(),r=e.hit;t.save(),t.translate(e.x,e.y),t.drawImage(r._canvas,0,0),t.restore()},t.prototype._getCachedSceneCanvas=function(){var t,e,r,a,i=this.filters(),n=this._getCanvasCache(),o=n.scene,s=n.filter,$=s.getContext();if(i){if(!this._filterUpToDate){var p=o.pixelRatio;try{for(t=i.length,$.clear(),$.drawImage(o._canvas,0,0,o.getWidth()/p,o.getHeight()/p),e=$.getImageData(0,0,s.getWidth(),s.getHeight()),r=0;r<t;r++)"function"==typeof(a=i[r])?(a.call(this,e),$.putImageData(e,0,0)):b.error("Filter should be type of function, but got "+typeof a+" insted. Please check correct filters")}catch(h){b.error("Unable to apply filter. "+h.message)}this._filterUpToDate=!0}return s}return o},t.prototype.on=function(t,e){if(3===arguments.length)return this._delegate.apply(this,arguments);var r,a,i,n,o=t.split(U),s=o.length;for(r=0;r<s;r++)i=(a=o[r].split("."))[0],n=a[1]||"",this.eventListeners[i]||(this.eventListeners[i]=[]),this.eventListeners[i].push({name:n,handler:e});return this},t.prototype.off=function(t,e){var r,a,i,n,o,s=(t||"").split(U),$=s.length;if(!t)for(a in this.eventListeners)this._off(a);for(r=0;r<$;r++)if(n=(i=s[r].split("."))[0],o=i[1],n)this.eventListeners[n]&&this._off(n,o,e);else for(a in this.eventListeners)this._off(a,o,e);return this},t.prototype.dispatchEvent=function(t){var e={target:this,type:t.type,evt:t};return this.fire(t.type,e),this},t.prototype.addEventListener=function(t,e){return this.on(t,function(t){e.call(this,t.evt)}),this},t.prototype.removeEventListener=function(t){return this.off(t),this},t.prototype._delegate=function(t,e,r){var a=this;this.on(t,function(t){for(var i=t.target.findAncestors(e,!0,a),n=0;n<i.length;n++)(t=b.cloneObject(t)).currentTarget=i[n],r.call(i[n],t)})},t.prototype.remove=function(){return this.isDragging()&&this.stopDrag(),g._dragElements.delete(this._id),this._remove(),this},t.prototype._remove=function(){this._clearSelfAndDescendantCache(fb),this._clearSelfAndDescendantCache(B),this._clearSelfAndDescendantCache(sa),this._clearSelfAndDescendantCache(na),this._clearSelfAndDescendantCache(Q);var t=this.getParent();t&&t.children&&(t.children.splice(this.index,1),t._setChildrenIndices(),this.parent=null)},t.prototype.destroy=function(){Ca(this.id(),this);for(var t=(this.name()||"").split(/\s/g),e=0;e<t.length;e++){var r=t[e];Da(r,this._id)}return this.remove(),this},t.prototype.getAttr=function(t){var e="get"+b._capitalize(t);return b._isFunction(this[e])?this[e]():this.attrs[t]},t.prototype.getAncestors=function(){for(var t=this.getParent(),e=new h;t;)e.push(t),t=t.getParent();return e},t.prototype.getAttrs=function(){return this.attrs||{}},t.prototype.setAttrs=function(t){var e,r;if(!t)return this;for(e in t)e!==Qb&&(r=cb+b._capitalize(e),b._isFunction(this[r])?this[r](t[e]):this._setAttr(e,t[e]));return this},t.prototype.isListening=function(){return this._getCache(na,this._isListening)},t.prototype._isListening=function(){var t=this.listening(),e=this.getParent();return"inherit"===t?!e||e.isListening():t},t.prototype.isVisible=function(){return this._getCache(sa,this._isVisible)},t.prototype._isVisible=function(t){var e=this.visible(),r=this.getParent();return"inherit"===e?!r||r===t||r._isVisible(t):t&&t!==r?e&&r._isVisible(t):e},t.prototype.shouldDrawHit=function(){var t=this.getLayer();return!t&&this.isListening()&&this.isVisible()||t&&t.hitGraphEnabled()&&this.isListening()&&this.isVisible()},t.prototype.show=function(){return this.visible(!0),this},t.prototype.hide=function(){return this.visible(!1),this},t.prototype.getZIndex=function(){return this.index||0},t.prototype.getAbsoluteZIndex=function(){var t,e,r,a,i=this.getDepth(),n=this,o=0;return n.nodeType!==Nb&&function s($){for(t=[],e=$.length,r=0;r<e;r++)a=$[r],o++,a.nodeType!==db&&(t=t.concat(a.getChildren().toArray())),a._id===n._id&&(r=e);t.length>0&&t[0].getDepth()<=i&&s(t)}(n.getStage().getChildren()),o},t.prototype.getDepth=function(){for(var t=0,e=this.parent;e;)t++,e=e.parent;return t},t.prototype.setPosition=function(t){return this.x(t.x),this.y(t.y),this},t.prototype.getPosition=function(){return{x:this.x(),y:this.y()}},t.prototype.getAbsolutePosition=function(t){for(var e=!1,r=this.parent;r;){if(r.isCached()){e=!0;break}r=r.parent}e&&!t&&(t=!0);var a=this.getAbsoluteTransform(t).getMatrix(),i=new ca,n=this.offset();return i.m=a.slice(),i.translate(n.x,n.y),i.getTranslation()},t.prototype.setAbsolutePosition=function(t){var e,r=this._clearTransform();return this.attrs.x=r.x,this.attrs.y=r.y,delete r.x,delete r.y,(e=this.getAbsoluteTransform()).invert(),e.translate(t.x,t.y),t={x:this.attrs.x+e.getTranslation().x,y:this.attrs.y+e.getTranslation().y},this.setPosition({x:t.x,y:t.y}),this._setTransform(r),this},t.prototype._setTransform=function(t){var e;for(e in t)this.attrs[e]=t[e];this._clearCache(V),this._clearSelfAndDescendantCache(B)},t.prototype._clearTransform=function(){var t={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,this._clearCache(V),this._clearSelfAndDescendantCache(B),t},t.prototype.move=function(t){var e=t.x,r=t.y,a=this.x(),i=this.y();return void 0!==e&&(a+=e),void 0!==r&&(i+=r),this.setPosition({x:a,y:i}),this},t.prototype._eachAncestorReverse=function(t,e){var r,a,i=[],n=this.getParent();if(e&&e._id===this._id)t(this);else{for(i.unshift(this);n&&(!e||n._id!==e._id);)i.unshift(n),n=n.parent;for(r=i.length,a=0;a<r;a++)t(i[a])}},t.prototype.rotate=function(t){return this.rotation(this.rotation()+t),this},t.prototype.moveToTop=function(){if(!this.parent)return b.warn("Node has no parent. moveToTop function is ignored."),!1;var t=this.index;return this.parent.children.splice(t,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0},t.prototype.moveUp=function(){if(!this.parent)return b.warn("Node has no parent. moveUp function is ignored."),!1;var t=this.index;return t<this.parent.getChildren().length-1&&(this.parent.children.splice(t,1),this.parent.children.splice(t+1,0,this),this.parent._setChildrenIndices(),!0)},t.prototype.moveDown=function(){if(!this.parent)return b.warn("Node has no parent. moveDown function is ignored."),!1;var t=this.index;return t>0&&(this.parent.children.splice(t,1),this.parent.children.splice(t-1,0,this),this.parent._setChildrenIndices(),!0)},t.prototype.moveToBottom=function(){if(!this.parent)return b.warn("Node has no parent. moveToBottom function is ignored."),!1;var t=this.index;return t>0&&(this.parent.children.splice(t,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0)},t.prototype.setZIndex=function(t){if(!this.parent)return b.warn("Node has no parent. zIndex parameter is ignored."),this;(t<0||t>=this.parent.children.length)&&b.warn("Unexpected value "+t+" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to "+(this.parent.children.length-1)+".");var e=this.index;return this.parent.children.splice(e,1),this.parent.children.splice(t,0,this),this.parent._setChildrenIndices(),this},t.prototype.getAbsoluteOpacity=function(){return this._getCache(Q,this._getAbsoluteOpacity)},t.prototype._getAbsoluteOpacity=function(){var t=this.opacity(),e=this.getParent();return e&&!e._isUnderCache&&(t*=e.getAbsoluteOpacity()),t},t.prototype.moveTo=function(t){return this.getParent()!==t&&(this._remove(),t.add(this)),this},t.prototype.toObject=function(){var t,e,r,a,i={},n=this.getAttrs();for(t in i.attrs={},n)e=n[t],b.isObject(e)&&!b._isPlainObject(e)&&!b._isArray(e)||(r="function"==typeof this[t]&&this[t],delete n[t],a=r?r.call(this):null,n[t]=e,a!==e&&(i.attrs[t]=e));return i.className=this.getClassName(),b._prepareToStringify(i)},t.prototype.toJSON=function(){return JSON.stringify(this.toObject())},t.prototype.getParent=function(){return this.parent},t.prototype.findAncestors=function(t,e,r){var a=[];e&&this._isMatch(t)&&a.push(this);for(var i=this.parent;i;){if(i===r)return a;i._isMatch(t)&&a.push(i),i=i.parent}return a},t.prototype.isAncestorOf=function(t){return!1},t.prototype.findAncestor=function(t,e,r){return this.findAncestors(t,e,r)[0]},t.prototype._isMatch=function(t){if(!t)return!1;if("function"==typeof t)return t(this);var e,r,a=t.replace(/ /g,"").split(","),i=a.length;for(e=0;e<i;e++)if(r=a[e],b.isValidSelector(r)||(b.warn("Selector \""+r+"\" is invalid. Allowed selectors examples are \"#foo\", \".bar\" or \"Group\"."),b.warn("If you have a custom shape with such className, please change it to start with upper letter like \"Triangle\"."),b.warn("Konva is awesome, right?")),"#"===r.charAt(0)){if(this.id()===r.slice(1))return!0}else if("."===r.charAt(0)){if(this.hasName(r.slice(1)))return!0}else if(this.className===r||this.nodeType===r)return!0;return!1},t.prototype.getLayer=function(){var t=this.getParent();return t?t.getLayer():null},t.prototype.getStage=function(){return this._getCache(fb,this._getStage)},t.prototype._getStage=function(){var t=this.getParent();return t?t.getStage():void 0},t.prototype.fire=function(t,e,r){return(e=e||{}).target=e.target||this,r?this._fireAndBubble(t,e):this._fire(t,e),this},t.prototype.getAbsoluteTransform=function(t){return t?this._getAbsoluteTransform(t):this._getCache(B,this._getAbsoluteTransform)},t.prototype._getAbsoluteTransform=function(t){var e=new ca;return this._eachAncestorReverse(function(t){var r=t.getTransformsEnabled();"all"===r?e.multiply(t.getTransform()):"position"===r&&e.translate(t.getX()-t.getOffsetX(),t.getY()-t.getOffsetY())},t),e},t.prototype.getAbsoluteScale=function(t){return t?this._getAbsoluteScale(t):this._getCache(ia,this._getAbsoluteScale)},t.prototype._getAbsoluteScale=function(t){for(var e=this;e;)e._isUnderCache&&(t=e),e=e.getParent();var r=1,a=1;return this._eachAncestorReverse(function(t){r*=t.scaleX(),a*=t.scaleY()},t),{x:r,y:a}},t.prototype.getTransform=function(){return this._getCache(V,this._getTransform)},t.prototype._getTransform=function(){var t=new ca,e=this.x(),r=this.y(),a=d.getAngle(this.rotation()),i=this.scaleX(),n=this.scaleY(),o=this.skewX(),s=this.skewY(),$=this.offsetX(),p=this.offsetY();return 0===e&&0===r||t.translate(e,r),0!==a&&t.rotate(a),0===o&&0===s||t.skew(o,s),1===i&&1===n||t.scale(i,n),0===$&&0===p||t.translate(-1*$,-1*p),t},t.prototype.clone=function(t){var e,r,a,i,n,o=b.cloneObject(this.attrs);for(var s in jb){delete o[jb[s]]}for(e in t)o[e]=t[e];var $=new this.constructor(o);for(e in this.eventListeners)for(a=(r=this.eventListeners[e]).length,i=0;i<a;i++)(n=r[i]).name.indexOf(Pb)<0&&($.eventListeners[e]||($.eventListeners[e]=[]),$.eventListeners[e].push(n));return $},t.prototype._toKonvaCanvas=function(t){t=t||{};var e=this.getClientRect(),r=this.getStage(),a=void 0!==t.x?t.x:e.x,i=void 0!==t.y?t.y:e.y,n=t.pixelRatio||1,o=new u({width:t.width||e.width||(r?r.width():0),height:t.height||e.height||(r?r.height():0),pixelRatio:n}),s=o.getContext();return s.save(),(a||i)&&s.translate(-1*a,-1*i),this.drawScene(o),s.restore(),o},t.prototype.toCanvas=function(t){return this._toKonvaCanvas(t)._canvas},t.prototype.toDataURL=function(t){var e=(t=t||{}).mimeType||null,r=t.quality||null,a=this._toKonvaCanvas(t).toDataURL(e,r);return t.callback&&t.callback(a),a},t.prototype.toImage=function(t){if(!t||!t.callback)throw"callback required for toImage method config argument";var e=t.callback;delete t.callback,b._urlToImage(this.toDataURL(t),function(t){e(t)})},t.prototype.setSize=function(t){return this.width(t.width),this.height(t.height),this},t.prototype.getSize=function(){return{width:this.width(),height:this.height()}},t.prototype.getClassName=function(){return this.className||this.nodeType},t.prototype.getType=function(){return this.nodeType},t.prototype.getDragDistance=function(){return void 0!==this.attrs.dragDistance?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():d.dragDistance},t.prototype._off=function(t,e,r){var a,i,n,o=this.eventListeners[t];for(a=0;a<o.length;a++)if(i=o[a].name,n=o[a].handler,!("konva"===i&&"konva"!==e||e&&i!==e||r&&r!==n)){if(o.splice(a,1),0===o.length){delete this.eventListeners[t];break}a--}},t.prototype._fireChangeEvent=function(t,e,r){this._fire(t+Rb,{oldVal:e,newVal:r})},t.prototype.setId=function(t){var e=this.id();return Ca(e,this),Sb(this,t),this._setAttr("id",t),this},t.prototype.setName=function(t){var e,r,a=(this.name()||"").split(/\s/g),i=(t||"").split(/\s/g);for(r=0;r<a.length;r++)e=a[r],-1===i.indexOf(e)&&e&&Da(e,this._id);for(r=0;r<i.length;r++)e=i[r],-1===a.indexOf(e)&&e&&Ra(this,e);return this._setAttr(Ob,t),this},t.prototype.addName=function(t){if(!this.hasName(t)){var e=this.name(),r=e?e+" "+t:t;this.setName(r)}return this},t.prototype.hasName=function(t){if(!t)return!1;var e=this.name();return!!e&&-1!==(e||"").split(/\s/g).indexOf(t)},t.prototype.removeName=function(t){var e=(this.name()||"").split(/\s/g),r=e.indexOf(t);return-1!==r&&(e.splice(r,1),this.setName(e.join(" "))),this},t.prototype.setAttr=function(t,e){var r=this[cb+b._capitalize(t)];return b._isFunction(r)?r.call(this,e):this._setAttr(t,e),this},t.prototype._setAttr=function(t,e){var r=this.attrs[t];(r!==e||b.isObject(e))&&(null==e?delete this.attrs[t]:this.attrs[t]=e,this._fireChangeEvent(t,r,e))},t.prototype._setComponentAttr=function(t,e,r){var a;void 0!==r&&((a=this.attrs[t])||(this.attrs[t]=this.getAttr(t)),this.attrs[t][e]=r,this._fireChangeEvent(t,a,r))},t.prototype._fireAndBubble=function(t,e,r){if(e&&this.nodeType===db&&(e.target=this),!((t===_a||t===ab)&&(r&&(this===r||this.isAncestorOf&&this.isAncestorOf(r))||"Stage"===this.nodeType&&!r))){this._fire(t,e);var a=(t===_a||t===ab)&&r&&r.isAncestorOf&&r.isAncestorOf(this)&&!r.isAncestorOf(this.parent);(e&&!e.cancelBubble||!e)&&this.parent&&this.parent.isListening()&&!a&&(r&&r.parent?this._fireAndBubble.call(this.parent,t,e,r.parent):this._fireAndBubble.call(this.parent,t,e))}},t.prototype._fire=function(t,e){var r,a=this.eventListeners[t];if(a)for((e=e||{}).currentTarget=this,e.type=t,r=0;r<a.length;r++)a[r].handler.call(this,e)},t.prototype.draw=function(){return this.drawScene(),this.drawHit(),this},t.prototype._createDragElement=function(t){var e=t?t.pointerId:void 0,r=this.getStage(),a=this.getAbsolutePosition(),i=r._getPointerById(e)||r._changedPointerPositions[0]||a;g._dragElements.set(this._id,{node:this,startPointerPos:i,offset:{x:i.x-a.x,y:i.y-a.y},dragStatus:"ready",pointerId:e})},t.prototype.startDrag=function(t){g._dragElements.has(this._id)||this._createDragElement(t),g._dragElements.get(this._id).dragStatus="dragging",this.fire("dragstart",{type:"dragstart",target:this,evt:t&&t.evt},!0)},t.prototype._setDragPosition=function(t,e){var r=this.getStage()._getPointerById(e.pointerId);if(r){var a={x:r.x-e.offset.x,y:r.y-e.offset.y},i=this.dragBoundFunc();if(void 0!==i){var n=i.call(this,a,t);n?a=n:b.warn("dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.")}this._lastPos&&this._lastPos.x===a.x&&this._lastPos.y===a.y||(this.setAbsolutePosition(a),this.getLayer()?this.getLayer().batchDraw():this.getStage()&&this.getStage().batchDraw()),this._lastPos=a}},t.prototype.stopDrag=function(t){var e=g._dragElements.get(this._id);e&&(e.dragStatus="stopped"),g._endDragBefore(t),g._endDragAfter(t)},t.prototype.setDraggable=function(t){this._setAttr("draggable",t),this._dragChange()},t.prototype.isDragging=function(){var t=g._dragElements.get(this._id);return!!t&&"dragging"===t.dragStatus},t.prototype._listenDrag=function(){this._dragCleanup(),this.on("mousedown.konva touchstart.konva",function(t){var e=this;if((!(void 0!==t.evt.button)||d.dragButtons.indexOf(t.evt.button)>=0)&&!this.isDragging()){var r=!1;g._dragElements.forEach(function(t){e.isAncestorOf(t.node)&&(r=!0)}),r||this._createDragElement(t)}})},t.prototype._dragChange=function(){this.attrs.draggable?this._listenDrag():(this._dragCleanup(),this.getStage()&&g._dragElements.has(this._id)&&this.stopDrag())},t.prototype._dragCleanup=function(){this.off("mousedown.konva"),this.off("touchstart.konva")},t.create=function(t,e){return b._isString(t)&&(t=JSON.parse(t)),this._createNode(t,e)},t._createNode=function(e,r){var a,i,n,o=t.prototype.getClassName.call(e),s=e.children;if(r&&(e.attrs.container=r),Z[o]||(b.warn("Can not find a node with class name \""+o+"\". Fallback to \"Shape\"."),o="Shape"),a=new(0,Z[o])(e.attrs),s)for(i=s.length,n=0;n<i;n++)a.add(t._createNode(s[n]));return a},t}(),j=f;p.Node=j,f.prototype.nodeType="Node",f.prototype._attrsAffectingSize=[],c.addGetterSetter(f,"zIndex"),c.addGetterSetter(f,"absolutePosition"),c.addGetterSetter(f,"position"),c.addGetterSetter(f,"x",0,e()),c.addGetterSetter(f,"y",0,e()),c.addGetterSetter(f,"globalCompositeOperation","source-over",n()),c.addGetterSetter(f,"opacity",1,e()),c.addGetterSetter(f,"name","",n()),c.addGetterSetter(f,"id","",n()),c.addGetterSetter(f,"rotation",0,e()),c.addComponentsGetterSetter(f,"scale",["x","y"]),c.addGetterSetter(f,"scaleX",1,e()),c.addGetterSetter(f,"scaleY",1,e()),c.addComponentsGetterSetter(f,"skew",["x","y"]),c.addGetterSetter(f,"skewX",0,e()),c.addGetterSetter(f,"skewY",0,e()),c.addComponentsGetterSetter(f,"offset",["x","y"]),c.addGetterSetter(f,"offsetX",0,e()),c.addGetterSetter(f,"offsetY",0,e()),c.addGetterSetter(f,"dragDistance",null,e()),c.addGetterSetter(f,"width",0,e()),c.addGetterSetter(f,"height",0,e()),c.addGetterSetter(f,"listening","inherit",function(t){return!0===t||!1===t||"inherit"===t||b.warn(t+" is a not valid value for \"listening\" attribute. The value may be true, false or \"inherit\"."),t}),c.addGetterSetter(f,"preventDefault",!0,r()),c.addGetterSetter(f,"filters",null,function(t){return this._filterUpToDate=!1,t}),c.addGetterSetter(f,"visible","inherit",function(t){return!0===t||!1===t||"inherit"===t||b.warn(t+" is a not valid value for \"visible\" attribute. The value may be true, false or \"inherit\"."),t}),c.addGetterSetter(f,"transformsEnabled","all",n()),c.addGetterSetter(f,"size"),c.addGetterSetter(f,"dragBoundFunc"),c.addGetterSetter(f,"draggable",!1,r()),c.backCompat(f,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"}),h.mapMethods(f);var ea={},Gb=ea&&ea.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(ea,"__esModule",{value:!0});var m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.children=new h,e}return Gb(e,t),e.prototype.getChildren=function(t){if(!t)return this.children;var e=new h;return this.children.each(function(r){t(r)&&e.push(r)}),e},e.prototype.hasChildren=function(){return this.getChildren().length>0},e.prototype.removeChildren=function(){for(var t,e=0;e<this.children.length;e++)(t=this.children[e]).parent=null,t.index=0,t.remove();return this.children=new h,this},e.prototype.destroyChildren=function(){for(var t,e=0;e<this.children.length;e++)(t=this.children[e]).parent=null,t.index=0,t.destroy();return this.children=new h,this},e.prototype.add=function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.add(arguments[e]);return this}if(t.getParent())return t.moveTo(this),this;var r=this.children;return this._validateAdd(t),t.index=r.length,t.parent=this,r.push(t),this._fire("add",{child:t}),this},e.prototype.destroy=function(){return this.hasChildren()&&this.destroyChildren(),t.prototype.destroy.call(this),this},e.prototype.find=function(t){return this._generalFind(t,!1)},e.prototype.get=function(t){return b.warn("collection.get() method is deprecated. Please use collection.find() instead."),this.find(t)},e.prototype.findOne=function(t){var e=this._generalFind(t,!0);return e.length>0?e[0]:void 0},e.prototype._generalFind=function(t,e){var r=[];return this._descendants(function(i){var n=i._isMatch(t);return n&&r.push(i),!(!n||!e)}),h.toCollection(r)},e.prototype._descendants=function(t){for(var e=0;e<this.children.length;e++){var r=this.children[e];if(t(r))return!0;if(r.hasChildren()&&r._descendants(t))return!0}return!1},e.prototype.toObject=function(){var t=j.prototype.toObject.call(this);t.children=[];for(var e=this.getChildren(),r=e.length,i=0;i<r;i++){var n=e[i];t.children.push(n.toObject())}return t},e.prototype._getDescendants=function(t){for(var e=[],r=t.length,i=0;i<r;i++){var n=t[i];this.isAncestorOf(n)&&e.push(n)}return e},e.prototype.isAncestorOf=function(t){for(var e=t.getParent();e;){if(e._id===this._id)return!0;e=e.getParent()}return!1},e.prototype.clone=function(t){var e=j.prototype.clone.call(this,t);return this.getChildren().each(function(t){e.add(t.clone())}),e},e.prototype.getAllIntersections=function(t){var e=[];return this.find("Shape").each(function(r){r.isVisible()&&r.intersects(t)&&e.push(r)}),e},e.prototype._setChildrenIndices=function(){this.children.each(function(t,e){t.index=e})},e.prototype.drawScene=function(t,e,r){var i=this.getLayer(),n=t||i&&i.getCanvas(),a=n&&n.getContext(),o=this._getCanvasCache(),s=o&&o.scene;return(this.isVisible()||r)&&(!r&&s?(a.save(),i._applyTransform(this,a,e),this._drawCachedSceneCanvas(a),a.restore()):this._drawChildren(n,"drawScene",e,!1,r,r)),this},e.prototype.drawHit=function(t,e,r){var i=this.getLayer(),n=t||i&&i.hitCanvas,a=n&&n.getContext(),o=this._getCanvasCache(),s=o&&o.hit;return(this.shouldDrawHit(n)||r)&&(!r&&s?(a.save(),i._applyTransform(this,a,e),this._drawCachedHitCanvas(a),a.restore()):this._drawChildren(n,"drawHit",e,!1,r,r)),this},e.prototype._drawChildren=function(t,e,r,i,n,a){var o,s,h=this.getLayer(),l=t&&t.getContext(),d=this.clipWidth(),c=this.clipHeight(),$=this.clipFunc(),p=d&&c||$;if(p&&h){l.save();var y=this.getAbsoluteTransform(r),u=y.getMatrix();l.transform(u[0],u[1],u[2],u[3],u[4],u[5]),l.beginPath(),$?$.call(this,l,this):(o=this.clipX(),s=this.clipY(),l.rect(o,s,d,c)),l.clip(),u=y.copy().invert().getMatrix(),l.transform(u[0],u[1],u[2],u[3],u[4],u[5])}var v="source-over"!==this.globalCompositeOperation()&&!a&&"drawScene"===e;v&&h&&(l.save(),l._applyGlobalCompositeOperation(this)),this.children.each(function(a){a[e](t,r,i,n)}),v&&h&&l.restore(),p&&h&&l.restore()},e.prototype.shouldDrawHit=function(t){if(t&&t.isCache)return!0;var e=this.getLayer(),r=!1;g._dragElements.forEach(function(t){"dragging"===t.dragStatus&&t.node.getLayer()===e&&(r=!0)});var i=!d.hitOnDragEnabled&&r;return e&&e.hitGraphEnabled()&&this.isVisible()&&!i},e.prototype.getClientRect=function(t){var e,r,i,n,a=(t=t||{}).skipTransform,o=t.relativeTo,s={x:1/0,y:1/0,width:0,height:0},h=this;this.children.each(function(a){if(a.visible()){var o=a.getClientRect({relativeTo:h,skipShadow:t.skipShadow,skipStroke:t.skipStroke});0===o.width&&0===o.height||(void 0===e?(e=o.x,r=o.y,i=o.x+o.width,n=o.y+o.height):(e=Math.min(e,o.x),r=Math.min(r,o.y),i=Math.max(i,o.x+o.width),n=Math.max(n,o.y+o.height)))}});for(var l=this.find("Shape"),d=!1,c=0;c<l.length;c++){if(l[c]._isVisible(this)){d=!0;break}}return s=d&&void 0!==e?{x:e,y:r,width:i-e,height:n-r}:{x:0,y:0,width:0,height:0},a?s:this._transformedRect(s,o)},e}(j),z=m;ea.Container=z,c.addComponentsGetterSetter(m,"clip",["x","y","width","height"]),c.addGetterSetter(m,"clipX",void 0,e()),c.addGetterSetter(m,"clipY",void 0,e()),c.addGetterSetter(m,"clipWidth",void 0,e()),c.addGetterSetter(m,"clipHeight",void 0,e()),c.addGetterSetter(m,"clipFunc"),h.mapMethods(m);var A={};Object.defineProperty(A,"__esModule",{value:!0});var M=new Map,wb=void 0!==d._global.PointerEvent;function Fb(e){return M.get(e)}var q=Fb;function Ea(e){return{evt:e,pointerId:e.pointerId}}A.getCapturedShape=q;var N=Ea;function Fc(e,r){return M.get(e)===r}A.createEvent=N;var ta=Fc;function Eb(e,r){xb(e),r.getStage()&&(M.set(e,r),wb&&r._fire("gotpointercapture",Ea(new PointerEvent("gotpointercapture"))))}A.hasPointerCapture=ta;var Ga=Eb;function xb(e,r){var t=M.get(e);if(t){var $=t.getStage();$&&$.content,M.delete(e),wb&&t._fire("lostpointercapture",Ea(new PointerEvent("lostpointercapture")))}}A.setPointerCapture=Ga;var y=xb;A.releaseCapture=y;var F={},Ib=F&&F.__extends||function(){var t=function(i,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])})(i,e)};return function(i,e){function n(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}();Object.defineProperty(F,"__esModule",{value:!0});var Jb="Stage",Kb="string",lb="px",E="mouseout",W="mouseleave",T="mouseover",ma="mouseenter",S="mousemove",ka="mousedown",Ba="mouseup",Ia="pointermove",Bb="pointerdown",ua="pointerup",Wb="pointercancel",Xb="lostpointercapture",ra="contextmenu",rb="click",pb="dblclick",pa="touchstart",Ha="touchend",ib="tap",gb="dbltap",ha="touchmove",Fa="wheel",fc="contentMouseout",gc="contentMouseover",hc="contentMousemove",ic="contentMousedown",jc="contentMouseup",kc="contentContextmenu",lc="contentClick",mc="contentDblclick",nc="contentTouchstart",oc="contentTouchend",pc="contentDbltap",qc="contentTap",rc="contentTouchmove",sc="contentWheel",tc="relative",uc="konvajs-content",vc="_",wc="container",xc=5,yc="",$a=[ma,ka,S,Ba,E,pa,ha,Ha,T,Fa,ra,Bb,Ia,ua,Wb,Xb],Ac=$a.length;function Bc(t,i){t.content.addEventListener(i,function(e){t[vc+i](e)},!1)}var Cc="Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);",Y=[];function Ya(t){return void 0===t&&(t={}),(t.clipFunc||t.clipWidth||t.clipHeight)&&b.warn("Stage does not support clipping. Please use clip for Layers or Groups."),t}F.stages=Y;var ga=function(t){function i(i){var e=t.call(this,Ya(i))||this;return e._pointerPositions=[],e._changedPointerPositions=[],e._buildDOM(),e._bindContentEvents(),Y.push(e),e.on("widthChange.konva heightChange.konva",e._resizeDOM),e.on("visibleChange.konva",e._checkVisibility),e.on("clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva",function(){Ya(e.attrs)}),e._checkVisibility(),e}return Ib(i,t),i.prototype._validateAdd=function(t){var i="Layer"===t.getType(),e="FastLayer"===t.getType();i||e||b.throw("You may only add layers to the stage.")},i.prototype._checkVisibility=function(){var t=this.visible()?"":"none";this.content.style.display=t},i.prototype.setContainer=function(t){if(typeof t===Kb){if("."===t.charAt(0)){var i=t.slice(1);t=document.getElementsByClassName(i)[0]}else{var e;e="#"!==t.charAt(0)?t:t.slice(1),t=document.getElementById(e)}if(!t)throw"Can not find container in document with id "+e}return this._setAttr(wc,t),this.content&&(this.content.parentElement&&this.content.parentElement.removeChild(this.content),t.appendChild(this.content)),this},i.prototype.shouldDrawHit=function(){return!0},i.prototype.clear=function(){var t,i=this.children,e=i.length;for(t=0;t<e;t++)i[t].clear();return this},i.prototype.clone=function(t){return t||(t={}),t.container=document.createElement("div"),z.prototype.clone.call(this,t)},i.prototype.destroy=function(){t.prototype.destroy.call(this);var i=this.content;i&&b._isInDocument(i)&&this.container().removeChild(i);var e=Y.indexOf(this);return e>-1&&Y.splice(e,1),this},i.prototype.getPointerPosition=function(){var t=this._pointerPositions[0]||this._changedPointerPositions[0];return t?{x:t.x,y:t.y}:(b.warn(Cc),null)},i.prototype._getPointerById=function(t){return this._pointerPositions.find(function(i){return i.id===t})},i.prototype.getPointersPositions=function(){return this._pointerPositions},i.prototype.getStage=function(){return this},i.prototype.getContent=function(){return this.content},i.prototype._toKonvaCanvas=function(t){var i=(t=t||{}).x||0,e=t.y||0,n=new u({width:t.width||this.width(),height:t.height||this.height(),pixelRatio:t.pixelRatio||1}),r=n.getContext()._context,o=this.children;return(i||e)&&r.translate(-1*i,-1*e),o.each(function(n){if(n.isVisible()){var o=n._toKonvaCanvas(t);r.drawImage(o._canvas,i,e,o.getWidth()/o.getPixelRatio(),o.getHeight()/o.getPixelRatio())}}),n},i.prototype.getIntersection=function(t,i){if(!t)return null;var e,n,r=this.children;for(e=r.length-1;e>=0;e--)if(n=r[e].getIntersection(t,i))return n;return null},i.prototype._resizeDOM=function(){if(this.content){var t,i,e=this.width(),n=this.height(),r=this.getChildren(),o=r.length;for(this.content.style.width=e+lb,this.content.style.height=n+lb,this.bufferCanvas.setSize(e,n),this.bufferHitCanvas.setSize(e,n),t=0;t<o;t++)(i=r[t]).setSize({width:e,height:n}),i.draw()}},i.prototype.add=function(i){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.add(arguments[e]);return this}t.prototype.add.call(this,i);var n=this.children.length;return n>xc&&b.warn("The stage has "+n+" layers. Recommended maximin number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group."),i._setCanvasSize(this.width(),this.height()),i.draw(),d.isBrowser&&this.content.appendChild(i.canvas._canvas),this},i.prototype.getParent=function(){return null},i.prototype.getLayer=function(){return null},i.prototype.hasPointerCapture=function(t){return ta(t,this)},i.prototype.setPointerCapture=function(t){Ga(t,this)},i.prototype.releaseCapture=function(t){y(t,this)},i.prototype.getLayers=function(){return this.getChildren()},i.prototype._bindContentEvents=function(){if(d.isBrowser)for(var t=0;t<Ac;t++)Bc(this,$a[t])},i.prototype._mouseenter=function(t){this.setPointersPositions(t),this._fire(ma,{evt:t,target:this,currentTarget:this})},i.prototype._mouseover=function(t){this.setPointersPositions(t),this._fire(gc,{evt:t}),this._fire(T,{evt:t,target:this,currentTarget:this})},i.prototype._mouseout=function(t){this.setPointersPositions(t);var i=this.targetShape,e=!g.isDragging||d.hitOnDragEnabled;i&&e?(i._fireAndBubble(E,{evt:t}),i._fireAndBubble(W,{evt:t}),this.targetShape=null):e&&(this._fire(W,{evt:t,target:this,currentTarget:this}),this._fire(E,{evt:t,target:this,currentTarget:this})),this.pointerPos=void 0,this._pointerPositions=[],this._fire(fc,{evt:t})},i.prototype._mousemove=function(t){if(d.UA.ieMobile)return this._touchmove(t);this.setPointersPositions(t);var i,e=b._getFirstPointerId(t),n=!g.isDragging||d.hitOnDragEnabled;if(n){if((i=this.getIntersection(this.getPointerPosition()))&&i.isListening()){var r=!this.targetShape||this.targetShape!==i;n&&r?(this.targetShape&&(this.targetShape._fireAndBubble(E,{evt:t,pointerId:e},i),this.targetShape._fireAndBubble(W,{evt:t,pointerId:e},i)),i._fireAndBubble(T,{evt:t,pointerId:e},this.targetShape),i._fireAndBubble(ma,{evt:t,pointerId:e},this.targetShape),i._fireAndBubble(S,{evt:t,pointerId:e}),this.targetShape=i):i._fireAndBubble(S,{evt:t,pointerId:e})}else this.targetShape&&n&&(this.targetShape._fireAndBubble(E,{evt:t,pointerId:e}),this.targetShape._fireAndBubble(W,{evt:t,pointerId:e}),this._fire(T,{evt:t,target:this,currentTarget:this,pointerId:e}),this.targetShape=null),this._fire(S,{evt:t,target:this,currentTarget:this,pointerId:e});this._fire(hc,{evt:t})}t.cancelable&&t.preventDefault()},i.prototype._mousedown=function(t){if(d.UA.ieMobile)return this._touchstart(t);this.setPointersPositions(t);var i=b._getFirstPointerId(t),e=this.getIntersection(this.getPointerPosition());g.justDragged=!1,d.listenClickTap=!0,e&&e.isListening()?(this.clickStartShape=e,e._fireAndBubble(ka,{evt:t,pointerId:i})):this._fire(ka,{evt:t,target:this,currentTarget:this,pointerId:i}),this._fire(ic,{evt:t})},i.prototype._mouseup=function(t){if(d.UA.ieMobile)return this._touchend(t);this.setPointersPositions(t);var i=b._getFirstPointerId(t),e=this.getIntersection(this.getPointerPosition()),n=this.clickStartShape,r=this.clickEndShape,o=!1;d.inDblClickWindow?(o=!0,clearTimeout(this.dblTimeout)):g.justDragged||(d.inDblClickWindow=!0,clearTimeout(this.dblTimeout)),this.dblTimeout=setTimeout(function(){d.inDblClickWindow=!1},d.dblClickWindow),e&&e.isListening()?(this.clickEndShape=e,e._fireAndBubble(Ba,{evt:t,pointerId:i}),d.listenClickTap&&n&&n._id===e._id&&(e._fireAndBubble(rb,{evt:t,pointerId:i}),o&&r&&r===e&&e._fireAndBubble(pb,{evt:t,pointerId:i}))):(this._fire(Ba,{evt:t,target:this,currentTarget:this,pointerId:i}),d.listenClickTap&&this._fire(rb,{evt:t,target:this,currentTarget:this,pointerId:i}),o&&this._fire(pb,{evt:t,target:this,currentTarget:this,pointerId:i})),this._fire(jc,{evt:t}),d.listenClickTap&&(this._fire(lc,{evt:t}),o&&this._fire(mc,{evt:t})),d.listenClickTap=!1,t.cancelable&&t.preventDefault()},i.prototype._contextmenu=function(t){this.setPointersPositions(t);var i=this.getIntersection(this.getPointerPosition());i&&i.isListening()?i._fireAndBubble(ra,{evt:t}):this._fire(ra,{evt:t,target:this,currentTarget:this}),this._fire(kc,{evt:t})},i.prototype._touchstart=function(t){var i=this;this.setPointersPositions(t);var e=!1;this._changedPointerPositions.forEach(function(n){var r=i.getIntersection(n);d.listenClickTap=!0,g.justDragged=!1,r&&r.isListening()&&(d.captureTouchEventsEnabled&&r.setPointerCapture(n.id),i.tapStartShape=r,r._fireAndBubble(pa,{evt:t,pointerId:n.id},i),e=!0,r.isListening()&&r.preventDefault()&&t.cancelable&&t.preventDefault())}),e||this._fire(pa,{evt:t,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),this._fire(nc,{evt:t})},i.prototype._touchmove=function(t){var i=this;if(this.setPointersPositions(t),!g.isDragging||d.hitOnDragEnabled){var e=!1,n={};this._changedPointerPositions.forEach(function(r){var o=q(r.id)||i.getIntersection(r);o&&o.isListening()&&(n[o._id]||(n[o._id]=!0,o._fireAndBubble(ha,{evt:t,pointerId:r.id}),e=!0,o.isListening()&&o.preventDefault()&&t.cancelable&&t.preventDefault()))}),e||this._fire(ha,{evt:t,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),this._fire(rc,{evt:t})}g.isDragging&&g.node.preventDefault()&&t.cancelable&&t.preventDefault()},i.prototype._touchend=function(t){var i=this;this.setPointersPositions(t);var e=this.clickEndShape,n=!1;d.inDblClickWindow?(n=!0,clearTimeout(this.dblTimeout)):g.justDragged||(d.inDblClickWindow=!0,clearTimeout(this.dblTimeout)),this.dblTimeout=setTimeout(function(){d.inDblClickWindow=!1},d.dblClickWindow);var r=!1,o={},a=!1,$=!1;this._changedPointerPositions.forEach(function(s){var v=q(s.id)||i.getIntersection(s);v&&v.releaseCapture(s.id),v&&v.isListening()&&(o[v._id]||(o[v._id]=!0,i.clickEndShape=v,v._fireAndBubble(Ha,{evt:t,pointerId:s.id}),r=!0,d.listenClickTap&&v===i.tapStartShape&&(a=!0,v._fireAndBubble(ib,{evt:t,pointerId:s.id}),n&&e&&e===v&&($=!0,v._fireAndBubble(gb,{evt:t,pointerId:s.id}))),v.isListening()&&v.preventDefault()&&t.cancelable&&t.preventDefault()))}),r||this._fire(Ha,{evt:t,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),d.listenClickTap&&!a&&this._fire(ib,{evt:t,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),n&&!$&&this._fire(gb,{evt:t,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),this._fire(oc,{evt:t}),d.listenClickTap&&(this._fire(qc,{evt:t}),n&&this._fire(pc,{evt:t})),d.listenClickTap=!1},i.prototype._wheel=function(t){this.setPointersPositions(t);var i=this.getIntersection(this.getPointerPosition());i&&i.isListening()?i._fireAndBubble(Fa,{evt:t}):this._fire(Fa,{evt:t,target:this,currentTarget:this}),this._fire(sc,{evt:t})},i.prototype._pointerdown=function(t){if(d._pointerEventsEnabled){this.setPointersPositions(t);var i=q(t.pointerId)||this.getIntersection(this.getPointerPosition());i&&i._fireAndBubble(Bb,N(t))}},i.prototype._pointermove=function(t){if(d._pointerEventsEnabled){this.setPointersPositions(t);var i=q(t.pointerId)||this.getIntersection(this.getPointerPosition());i&&i._fireAndBubble(Ia,N(t))}},i.prototype._pointerup=function(t){if(d._pointerEventsEnabled){this.setPointersPositions(t);var i=q(t.pointerId)||this.getIntersection(this.getPointerPosition());i&&i._fireAndBubble(ua,N(t)),y(t.pointerId)}},i.prototype._pointercancel=function(t){if(d._pointerEventsEnabled){this.setPointersPositions(t);var i=q(t.pointerId)||this.getIntersection(this.getPointerPosition());i&&i._fireAndBubble(ua,N(t)),y(t.pointerId)}},i.prototype._lostpointercapture=function(t){y(t.pointerId)},i.prototype.setPointersPositions=function(t){var i=this,e=this._getContentPosition(),n=null,r=null;if(void 0!==(t=t||window.event).touches){if(this._pointerPositions=[],this._changedPointerPositions=[],h.prototype.each.call(t.touches,function(t){i._pointerPositions.push({id:t.identifier,x:t.clientX-e.left,y:t.clientY-e.top})}),h.prototype.each.call(t.changedTouches||t.touches,function(t){i._changedPointerPositions.push({id:t.identifier,x:t.clientX-e.left,y:t.clientY-e.top})}),t.touches.length>0){var o=t.touches[0];n=o.clientX-e.left,r=o.clientY-e.top}}else n=t.clientX-e.left,r=t.clientY-e.top,this.pointerPos={x:n,y:r},this._pointerPositions=[{x:n,y:r,id:b._getFirstPointerId(t)}],this._changedPointerPositions=[{x:n,y:r,id:b._getFirstPointerId(t)}]},i.prototype._setPointerPosition=function(t){b.warn("Method _setPointerPosition is deprecated. Use \"stage.setPointersPositions(event)\" instead."),this.setPointersPositions(t)},i.prototype._getContentPosition=function(){var t=this.content.getBoundingClientRect?this.content.getBoundingClientRect():{top:0,left:0};return{top:t.top,left:t.left}},i.prototype._buildDOM=function(){if(this.bufferCanvas=new u,this.bufferHitCanvas=new da({pixelRatio:1}),d.isBrowser){var t=this.container();if(!t)throw"Stage has no container. A container is required.";t.innerHTML=yc,this.content=document.createElement("div"),this.content.style.position=tc,this.content.style.userSelect="none",this.content.className=uc,this.content.setAttribute("role","presentation"),t.appendChild(this.content),this._resizeDOM()}},i.prototype.cache=function(){return b.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes."),this},i.prototype.clearCache=function(){return this},i.prototype.batchDraw=function(){return this.children.each(function(t){t.batchDraw()}),this},i}(z),Na=ga;F.Stage=Na,ga.prototype.nodeType=Jb,J(ga),c.addGetterSetter(ga,"container");var aa={},Ic=aa&&aa.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function a(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}();Object.defineProperty(aa,"__esModule",{value:!0});var K=function(t){function e(e){var n=t.call(this,e)||this;return n.canvas=new u,n._waitingForDraw=!1,n.on("visibleChange",n._checkVisibility),n._checkVisibility(),n.on("imageSmoothingEnabledChange",n._checkSmooth),n._checkSmooth(),n}return Ic(e,t),e.prototype.createPNGStream=function(){return this.canvas._canvas.createPNGStream()},e.prototype.getCanvas=function(){return this.canvas},e.prototype.getHitCanvas=function(){return this.hitCanvas},e.prototype.getContext=function(){return this.getCanvas().getContext()},e.prototype.clear=function(t){return this.getContext().clear(t),this},e.prototype.setZIndex=function(e){t.prototype.setZIndex.call(this,e);var n=this.getStage();return n&&(n.content.removeChild(this.getCanvas()._canvas),e<n.getChildren().length-1?n.content.insertBefore(this.getCanvas()._canvas,n.getChildren()[e+1].getCanvas()._canvas):n.content.appendChild(this.getCanvas()._canvas)),this},e.prototype.moveToTop=function(){j.prototype.moveToTop.call(this);var t=this.getStage();return t&&(t.content.removeChild(this.getCanvas()._canvas),t.content.appendChild(this.getCanvas()._canvas)),!0},e.prototype.moveUp=function(){if(!j.prototype.moveUp.call(this))return!1;var t=this.getStage();return!!t&&(t.content.removeChild(this.getCanvas()._canvas),this.index<t.getChildren().length-1?t.content.insertBefore(this.getCanvas()._canvas,t.getChildren()[this.index+1].getCanvas()._canvas):t.content.appendChild(this.getCanvas()._canvas),!0)},e.prototype.moveDown=function(){if(j.prototype.moveDown.call(this)){var t=this.getStage();if(t){var e=t.getChildren();t.content.removeChild(this.getCanvas()._canvas),t.content.insertBefore(this.getCanvas()._canvas,e[this.index+1].getCanvas()._canvas)}return!0}return!1},e.prototype.moveToBottom=function(){if(j.prototype.moveToBottom.call(this)){var t=this.getStage();if(t){var e=t.getChildren();t.content.removeChild(this.getCanvas()._canvas),t.content.insertBefore(this.getCanvas()._canvas,e[1].getCanvas()._canvas)}return!0}return!1},e.prototype.getLayer=function(){return this},e.prototype.hitGraphEnabled=function(){return!0},e.prototype.remove=function(){var t=this.getCanvas()._canvas;return j.prototype.remove.call(this),t&&t.parentNode&&b._isInDocument(t)&&t.parentNode.removeChild(t),this},e.prototype.getStage=function(){return this.parent},e.prototype.setSize=function(t){var e=t.width,n=t.height;return this.canvas.setSize(e,n),this},e.prototype._toKonvaCanvas=function(t){return(t=t||{}).width=t.width||this.getWidth(),t.height=t.height||this.getHeight(),t.x=void 0!==t.x?t.x:this.x(),t.y=void 0!==t.y?t.y:this.y(),j.prototype._toKonvaCanvas.call(this,t)},e.prototype._checkVisibility=function(){var t=this.visible();this.canvas._canvas.style.display=t?"block":"none"},e.prototype._checkSmooth=function(){this.getContext()._context.imageSmoothingEnabled=this.imageSmoothingEnabled()},e.prototype.getWidth=function(){if(this.parent)return this.parent.width()},e.prototype.setWidth=function(){b.warn("Can not change width of layer. Use \"stage.width(value)\" function instead.")},e.prototype.getHeight=function(){if(this.parent)return this.parent.height()},e.prototype.setHeight=function(){b.warn("Can not change height of layer. Use \"stage.height(value)\" function instead.")},e.prototype.getIntersection=function(t,e){return null},e.prototype.batchDraw=function(){var t=this;return this._waitingForDraw||(this._waitingForDraw=!0,b.requestAnimFrame(function(){t.draw(),t._waitingForDraw=!1})),this},e.prototype._applyTransform=function(t,e,n){var a=t.getAbsoluteTransform(n).getMatrix();e.transform(a[0],a[1],a[2],a[3],a[4],a[5])},e}(z),la=K;aa.BaseLayer=la,K.prototype.nodeType="BaseLayer",c.addGetterSetter(K,"imageSmoothingEnabled",!0),c.addGetterSetter(K,"clearBeforeDraw",!0),h.mapMethods(K);var L={},Mc=L&&L.__extends||function(){var a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,t){a.__proto__=t}||function(a,t){for(var e in t)t.hasOwnProperty(e)&&(a[e]=t[e])})(t,e)};return function(t,e){function r(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}();Object.defineProperty(L,"__esModule",{value:!0});var Nc,zb="hasShadow",tb="shadowRGBA",nb="patternImage",eb="linearGradient",bb="radialGradient";function xa(){return Nc||(Nc=b.createCanvasElement().getContext("2d"))}var G={};function Vc(a){a.fill()}function Wc(a){a.stroke()}function Xc(a){a.fill()}function Yc(a){a.stroke()}function Zc(){this._clearCache(zb)}function $c(){this._clearCache(tb)}function _c(){this._clearCache(nb)}function ad(){this._clearCache(eb)}function bd(){this._clearCache(bb)}L.shapes=G;var a=function(a){function t(t){for(var e,r=a.call(this,t)||this;!(e=b.getRandomColor())||e in G;);return r.colorKey=e,G[e]=r,r.on("shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",Zc),r.on("shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",$c),r.on("fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva",_c),r.on("fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva",ad),r.on("fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva",bd),r}return Mc(t,a),t.prototype.getContext=function(){return this.getLayer().getContext()},t.prototype.getCanvas=function(){return this.getLayer().getCanvas()},t.prototype.getSceneFunc=function(){return this.attrs.sceneFunc||this._sceneFunc},t.prototype.getHitFunc=function(){return this.attrs.hitFunc||this._hitFunc},t.prototype.hasShadow=function(){return this._getCache(zb,this._hasShadow)},t.prototype._hasShadow=function(){return this.shadowEnabled()&&0!==this.shadowOpacity()&&!!(this.shadowColor()||this.shadowBlur()||this.shadowOffsetX()||this.shadowOffsetY())},t.prototype._getFillPattern=function(){return this._getCache(nb,this.__getFillPattern)},t.prototype.__getFillPattern=function(){if(this.fillPatternImage())return xa().createPattern(this.fillPatternImage(),this.fillPatternRepeat()||"repeat")},t.prototype._getLinearGradient=function(){return this._getCache(eb,this.__getLinearGradient)},t.prototype.__getLinearGradient=function(){var a=this.fillLinearGradientColorStops();if(a){for(var t=xa(),e=this.fillLinearGradientStartPoint(),r=this.fillLinearGradientEndPoint(),o=t.createLinearGradient(e.x,e.y,r.x,r.y),i=0;i<a.length;i+=2)o.addColorStop(a[i],a[i+1]);return o}},t.prototype._getRadialGradient=function(){return this._getCache(bb,this.__getRadialGradient)},t.prototype.__getRadialGradient=function(){var a=this.fillRadialGradientColorStops();if(a){for(var t=xa(),e=this.fillRadialGradientStartPoint(),r=this.fillRadialGradientEndPoint(),o=t.createRadialGradient(e.x,e.y,this.fillRadialGradientStartRadius(),r.x,r.y,this.fillRadialGradientEndRadius()),i=0;i<a.length;i+=2)o.addColorStop(a[i],a[i+1]);return o}},t.prototype.getShadowRGBA=function(){return this._getCache(tb,this._getShadowRGBA)},t.prototype._getShadowRGBA=function(){if(this.hasShadow()){var a=b.colorToRGBA(this.shadowColor());return"rgba("+a.r+","+a.g+","+a.b+","+a.a*(this.shadowOpacity()||1)+")"}},t.prototype.hasFill=function(){return!!(this.fill()||this.fillPatternImage()||this.fillLinearGradientColorStops()||this.fillRadialGradientColorStops())},t.prototype.hasStroke=function(){return this.strokeEnabled()&&this.strokeWidth()&&!(!this.stroke()&&!this.strokeLinearGradientColorStops())},t.prototype.hasHitStroke=function(){var a=this.hitStrokeWidth();return this.strokeEnabled()&&(a||this.strokeWidth()&&"auto"===a)},t.prototype.intersects=function(a){var t=this.getStage().bufferHitCanvas;return t.getContext().clear(),this.drawHit(t),t.context.getImageData(Math.round(a.x),Math.round(a.y),1,1).data[3]>0},t.prototype.destroy=function(){return j.prototype.destroy.call(this),delete G[this.colorKey],delete this.colorKey,this},t.prototype._useBufferCanvas=function(a){return!(a&&!this.hasShadow()||!this.perfectDrawEnabled()||1===this.getAbsoluteOpacity()||!this.hasFill()||!this.hasStroke()||!this.getStage())},t.prototype.setStrokeHitEnabled=function(a){a?this.hitStrokeWidth("auto"):this.hitStrokeWidth(0)},t.prototype.getStrokeHitEnabled=function(){return 0!==this.hitStrokeWidth()},t.prototype.getSelfRect=function(){var a=this.size();return{x:this._centroid?Math.round(-a.width/2):0,y:this._centroid?Math.round(-a.height/2):0,width:a.width,height:a.height}},t.prototype.getClientRect=function(a){var t=(a=a||{}).skipTransform,e=a.relativeTo,r=this.getSelfRect(),o=!a.skipStroke&&this.hasStroke()&&this.strokeWidth()||0,i=r.width+o,$=r.height+o,n=!a.skipShadow&&this.hasShadow(),s=n?this.shadowOffsetX():0,h=n?this.shadowOffsetY():0,d=i+Math.abs(s),l=$+Math.abs(h),g=n&&this.shadowBlur()||0,c=d+2*g,v=l+2*g,p=0;Math.round(o/2)!==o/2&&(p=1);var y={width:c+p,height:v+p,x:-Math.round(o/2+g)+Math.min(s,0)+r.x,y:-Math.round(o/2+g)+Math.min(h,0)+r.y};return t?y:this._transformedRect(y,e)},t.prototype.drawScene=function(a,t,e,r){var o,i,$=this.getLayer(),n=a||$.getCanvas(),s=n.getContext(),h=this._getCanvasCache(),d=this.sceneFunc(),l=this.hasShadow(),g=this.hasStroke();if(!this.isVisible()&&!e)return this;if(h)return s.save(),$._applyTransform(this,s,t),this._drawCachedSceneCanvas(s),s.restore(),this;if(!d)return this;if(s.save(),this._useBufferCanvas(e)&&!r){if((i=(o=this.getStage().bufferCanvas).getContext()).clear(),i.save(),i._applyLineJoin(this),!e)if($)$._applyTransform(this,i,t);else{var c=this.getAbsoluteTransform(t).getMatrix();s.transform(c[0],c[1],c[2],c[3],c[4],c[5])}d.call(this,i,this),i.restore();var v=o.pixelRatio;l&&!n.hitCanvas?(s.save(),s._applyShadow(this),s._applyOpacity(this),s._applyGlobalCompositeOperation(this),s.drawImage(o._canvas,0,0,o.width/v,o.height/v),s.restore()):(s._applyOpacity(this),s._applyGlobalCompositeOperation(this),s.drawImage(o._canvas,0,0,o.width/v,o.height/v))}else{if(s._applyLineJoin(this),!e)if($)$._applyTransform(this,s,t);else{var p=this.getAbsoluteTransform(t).getMatrix();s.transform(p[0],p[1],p[2],p[3],p[4],p[5])}l&&g&&!n.hitCanvas?(s.save(),e||(s._applyOpacity(this),s._applyGlobalCompositeOperation(this)),s._applyShadow(this),d.call(this,s,this),s.restore(),this.hasFill()&&this.shadowForStrokeEnabled()&&d.call(this,s,this)):l&&!n.hitCanvas?(s.save(),e||(s._applyOpacity(this),s._applyGlobalCompositeOperation(this)),s._applyShadow(this),d.call(this,s,this),s.restore()):(e||(s._applyOpacity(this),s._applyGlobalCompositeOperation(this)),d.call(this,s,this))}return s.restore(),this},t.prototype.drawHit=function(a,t,e){var r=this.getLayer(),o=a||r.hitCanvas,i=o&&o.getContext(),$=this.hitFunc()||this.sceneFunc(),n=this._getCanvasCache(),s=n&&n.hit;if(this.colorKey||(console.log(this),b.warn("Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. See the shape in logs above. If you want to reuse shape you should call remove() instead of destroy()")),!this.shouldDrawHit()&&!e)return this;if(s)return i.save(),r._applyTransform(this,i,t),this._drawCachedHitCanvas(i),i.restore(),this;if(!$)return this;if(i.save(),i._applyLineJoin(this),!e)if(r)r._applyTransform(this,i,t);else{var h=this.getAbsoluteTransform(t).getMatrix();i.transform(h[0],h[1],h[2],h[3],h[4],h[5])}return $.call(this,i,this),i.restore(),this},t.prototype.drawHitFromCache=function(a){void 0===a&&(a=0);var t,e,r,o,i,$=this._getCanvasCache(),n=this._getCachedSceneCanvas(),s=$.hit,h=s.getContext(),d=s.getWidth(),l=s.getHeight();h.clear(),h.drawImage(n._canvas,0,0,d,l);try{for(r=(e=(t=h.getImageData(0,0,d,l)).data).length,o=b._hexToRgb(this.colorKey),i=0;i<r;i+=4)e[i+3]>a?(e[i]=o.r,e[i+1]=o.g,e[i+2]=o.b,e[i+3]=255):e[i+3]=0;h.putImageData(t,0,0)}catch(g){b.error("Unable to draw hit graph from cached scene canvas. "+g.message)}return this},t.prototype.hasPointerCapture=function(a){return ta(a,this)},t.prototype.setPointerCapture=function(a){Ga(a,this)},t.prototype.releaseCapture=function(a){y(a,this)},t}(j),La=a;L.Shape=La,a.prototype._fillFunc=Vc,a.prototype._strokeFunc=Wc,a.prototype._fillFuncHit=Xc,a.prototype._strokeFuncHit=Yc,a.prototype._centroid=!1,a.prototype.nodeType="Shape",J(a),c.addGetterSetter(a,"stroke",void 0,n()),c.addGetterSetter(a,"strokeWidth",2,e()),c.addGetterSetter(a,"hitStrokeWidth","auto",ob()),c.addGetterSetter(a,"strokeHitEnabled",!0,r()),c.addGetterSetter(a,"perfectDrawEnabled",!0,r()),c.addGetterSetter(a,"shadowForStrokeEnabled",!0,r()),c.addGetterSetter(a,"lineJoin"),c.addGetterSetter(a,"lineCap"),c.addGetterSetter(a,"sceneFunc"),c.addGetterSetter(a,"hitFunc"),c.addGetterSetter(a,"dash"),c.addGetterSetter(a,"dashOffset",0,e()),c.addGetterSetter(a,"shadowColor",void 0,n()),c.addGetterSetter(a,"shadowBlur",0,e()),c.addGetterSetter(a,"shadowOpacity",1,e()),c.addComponentsGetterSetter(a,"shadowOffset",["x","y"]),c.addGetterSetter(a,"shadowOffsetX",0,e()),c.addGetterSetter(a,"shadowOffsetY",0,e()),c.addGetterSetter(a,"fillPatternImage"),c.addGetterSetter(a,"fill",void 0,n()),c.addGetterSetter(a,"fillPatternX",0,e()),c.addGetterSetter(a,"fillPatternY",0,e()),c.addGetterSetter(a,"fillLinearGradientColorStops"),c.addGetterSetter(a,"strokeLinearGradientColorStops"),c.addGetterSetter(a,"fillRadialGradientStartRadius",0),c.addGetterSetter(a,"fillRadialGradientEndRadius",0),c.addGetterSetter(a,"fillRadialGradientColorStops"),c.addGetterSetter(a,"fillPatternRepeat","repeat"),c.addGetterSetter(a,"fillEnabled",!0),c.addGetterSetter(a,"strokeEnabled",!0),c.addGetterSetter(a,"shadowEnabled",!0),c.addGetterSetter(a,"dashEnabled",!0),c.addGetterSetter(a,"strokeScaleEnabled",!0),c.addGetterSetter(a,"fillPriority","color"),c.addComponentsGetterSetter(a,"fillPatternOffset",["x","y"]),c.addGetterSetter(a,"fillPatternOffsetX",0,e()),c.addGetterSetter(a,"fillPatternOffsetY",0,e()),c.addComponentsGetterSetter(a,"fillPatternScale",["x","y"]),c.addGetterSetter(a,"fillPatternScaleX",1,e()),c.addGetterSetter(a,"fillPatternScaleY",1,e()),c.addComponentsGetterSetter(a,"fillLinearGradientStartPoint",["x","y"]),c.addComponentsGetterSetter(a,"strokeLinearGradientStartPoint",["x","y"]),c.addGetterSetter(a,"fillLinearGradientStartPointX",0),c.addGetterSetter(a,"strokeLinearGradientStartPointX",0),c.addGetterSetter(a,"fillLinearGradientStartPointY",0),c.addGetterSetter(a,"strokeLinearGradientStartPointY",0),c.addComponentsGetterSetter(a,"fillLinearGradientEndPoint",["x","y"]),c.addComponentsGetterSetter(a,"strokeLinearGradientEndPoint",["x","y"]),c.addGetterSetter(a,"fillLinearGradientEndPointX",0),c.addGetterSetter(a,"strokeLinearGradientEndPointX",0),c.addGetterSetter(a,"fillLinearGradientEndPointY",0),c.addGetterSetter(a,"strokeLinearGradientEndPointY",0),c.addComponentsGetterSetter(a,"fillRadialGradientStartPoint",["x","y"]),c.addGetterSetter(a,"fillRadialGradientStartPointX",0),c.addGetterSetter(a,"fillRadialGradientStartPointY",0),c.addComponentsGetterSetter(a,"fillRadialGradientEndPoint",["x","y"]),c.addGetterSetter(a,"fillRadialGradientEndPointX",0),c.addGetterSetter(a,"fillRadialGradientEndPointY",0),c.addGetterSetter(a,"fillPatternRotation",0),c.backCompat(a,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"}),h.mapMethods(a);var R={},fd=R&&R.__extends||function(){var t=function(a,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,a){t.__proto__=a}||function(t,a){for(var e in a)a.hasOwnProperty(e)&&(t[e]=a[e])})(a,e)};return function(a,e){function r(){this.constructor=a}t(a,e),a.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}();Object.defineProperty(R,"__esModule",{value:!0});var gd="#",hd="beforeDraw",id="draw",yb=[{x:0,y:0},{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],kd=yb.length,H=function(t){function a(){var a=null!==t&&t.apply(this,arguments)||this;return a.hitCanvas=new da({pixelRatio:1}),a}return fd(a,t),a.prototype._setCanvasSize=function(t,a){this.canvas.setSize(t,a),this.hitCanvas.setSize(t,a),this._checkSmooth()},a.prototype._validateAdd=function(t){var a=t.getType();"Group"!==a&&"Shape"!==a&&b.throw("You may only add groups and shapes to a layer.")},a.prototype.getIntersection=function(t,a){var e,r,v,$;if(!this.hitGraphEnabled()||!this.isVisible())return null;for(var i=1,n=!1;;){for(r=0;r<kd;r++){if(v=yb[r],($=(e=this._getIntersection({x:t.x+v.x*i,y:t.y+v.y*i})).shape)&&a)return $.findAncestor(a,!0);if($)return $;if(n=!!e.antialiased,!e.antialiased)break}if(!n)return null;i+=1}},a.prototype._getIntersection=function(t){var a,e,r=this.hitCanvas.pixelRatio,v=this.hitCanvas.context.getImageData(Math.round(t.x*r),Math.round(t.y*r),1,1).data,$=v[3];return 255===$?(a=b._rgbToHex(v[0],v[1],v[2]),(e=G[gd+a])?{shape:e}:{antialiased:!0}):$>0?{antialiased:!0}:{}},a.prototype.drawScene=function(t,a){var e=this.getLayer(),r=t||e&&e.getCanvas();return this._fire(hd,{node:this}),this.clearBeforeDraw()&&r.getContext().clear(),z.prototype.drawScene.call(this,r,a),this._fire(id,{node:this}),this},a.prototype.drawHit=function(t,a){var e=this.getLayer(),r=t||e&&e.hitCanvas;return e&&e.clearBeforeDraw()&&e.getHitCanvas().getContext().clear(),z.prototype.drawHit.call(this,r,a),this},a.prototype.clear=function(t){return la.prototype.clear.call(this,t),this.getHitCanvas().getContext().clear(t),this},a.prototype.enableHitGraph=function(){return this.hitGraphEnabled(!0),this},a.prototype.disableHitGraph=function(){return this.hitGraphEnabled(!1),this},a.prototype.toggleHitCanvas=function(){if(this.parent){var t=this.parent;!!this.hitCanvas._canvas.parentNode?t.content.removeChild(this.hitCanvas._canvas):t.content.appendChild(this.hitCanvas._canvas)}},a.prototype.setSize=function(a){var e=a.width,r=a.height;return t.prototype.setSize.call(this,{width:e,height:r}),this.hitCanvas.setSize(e,r),this},a}(la),Za=H;R.Layer=Za,H.prototype.nodeType="Layer",J(H),c.addGetterSetter(H,"hitGraphEnabled",!0,r()),h.mapMethods(H);var fa={},od=fa&&fa.__extends||function(){var t=function(r,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e])})(r,e)};return function(r,e){function a(){this.constructor=r}t(r,e),r.prototype=null===e?Object.create(e):(a.prototype=e.prototype,new a)}}();Object.defineProperty(fa,"__esModule",{value:!0});var k=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return od(r,t),r.prototype._useBufferCanvas=function(){return!(!this.hasShadow()&&1===this.getAbsoluteOpacity()||!this.hasStroke()||!this.getStage())},r.prototype._sceneFunc=function(t){var r,e,a,$=this.width(),o=this.height(),h=this.image();h&&(r=this.cropWidth(),e=this.cropHeight(),a=r&&e?[h,this.cropX(),this.cropY(),r,e,0,0,$,o]:[h,0,0,$,o]),(this.hasFill()||this.hasStroke())&&(t.beginPath(),t.rect(0,0,$,o),t.closePath(),t.fillStrokeShape(this)),h&&t.drawImage.apply(t,a)},r.prototype._hitFunc=function(t){var r=this.width(),e=this.height();t.beginPath(),t.rect(0,0,r,e),t.closePath(),t.fillStrokeShape(this)},r.prototype.getWidth=function(){var t=this.image();return this.attrs.width||(t?t.width:0)},r.prototype.getHeight=function(){var t=this.image();return this.attrs.height||(t?t.height:0)},r.fromURL=function(t,e){var a=b.createImageElement();a.onload=function(){var t=new r({image:a});e(t)},a.crossOrigin="Anonymous",a.src=t},r}(La),Sa=k;fa.Image=Sa,k.prototype.className="Image",J(k),c.addGetterSetter(k,"image"),c.addComponentsGetterSetter(k,"crop",["x","y","width","height"]),c.addGetterSetter(k,"cropX",0,e()),c.addGetterSetter(k,"cropY",0,e()),c.addGetterSetter(k,"cropWidth",0,e()),c.addGetterSetter(k,"cropHeight",0,e()),h.mapMethods(k);var Qa={};Object.defineProperty(Qa,"__esModule",{value:!0});var oa=i.performance&&i.performance.now?function(){return i.performance.now()}:function(){return new Date().getTime()},td=function(){function i(t,n){this.id=i.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:oa(),frameRate:0},this.func=t,this.setLayers(n)}return i.prototype.setLayers=function(i){var t=[];return t=i?i.length>0?i:[i]:[],this.layers=t,this},i.prototype.getLayers=function(){return this.layers},i.prototype.addLayer=function(i){var t,n=this.layers,a=n.length;for(t=0;t<a;t++)if(n[t]._id===i._id)return!1;return this.layers.push(i),!0},i.prototype.isRunning=function(){var t,n=i.animations,a=n.length;for(t=0;t<a;t++)if(n[t].id===this.id)return!0;return!1},i.prototype.start=function(){return this.stop(),this.frame.timeDiff=0,this.frame.lastTime=oa(),i._addAnimation(this),this},i.prototype.stop=function(){return i._removeAnimation(this),this},i.prototype._updateFrameObject=function(i){this.frame.timeDiff=i-this.frame.lastTime,this.frame.lastTime=i,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff},i._addAnimation=function(i){this.animations.push(i),this._handleAnimation()},i._removeAnimation=function(i){var t,n=i.id,a=this.animations,e=a.length;for(t=0;t<e;t++)if(a[t].id===n){this.animations.splice(t,1);break}},i._runFrames=function(){var i,t,n,a,e,r,o,s,m={},f=this.animations;for(a=0;a<f.length;a++)if(t=(i=f[a]).layers,n=i.func,i._updateFrameObject(oa()),r=t.length,!n||!1!==n.call(i,i.frame))for(e=0;e<r;e++)void 0!==(o=t[e])._id&&(m[o._id]=o);for(s in m)m.hasOwnProperty(s)&&m[s].draw()},i._animationLoop=function(){var t=i;t.animations.length?(t._runFrames(),requestAnimationFrame(t._animationLoop)):t.animRunning=!1},i._handleAnimation=function(){this.animRunning||(this.animRunning=!0,requestAnimationFrame(this._animationLoop))},i.animations=[],i.animIdCounter=0,i.animRunning=!1,i}(),Ja=td;Qa.Animation=Ja;var wa={};Object.defineProperty(wa,"__esModule",{value:!0});var wd={node:1,duration:1,easing:1,onFinish:1,yoyo:1},xd=1,Ta=2,Ma=3,Ad=0,Cb=["fill","stroke","shadowColor"],Cd=function(){function t(t,e,i,n,r,s,o){this.prop=t,this.propFunc=e,this.begin=n,this._pos=n,this.duration=s,this._change=0,this.prevPos=0,this.yoyo=o,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=i,this._change=r-this.begin,this.pause()}return t.prototype.fire=function(t){var e=this[t];e&&e()},t.prototype.setTime=function(t){t>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():t<0?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=t,this.update())},t.prototype.getTime=function(){return this._time},t.prototype.setPosition=function(t){this.prevPos=this._pos,this.propFunc(t),this._pos=t},t.prototype.getPosition=function(t){return void 0===t&&(t=this._time),this.func(t,this.begin,this._change,this.duration)},t.prototype.play=function(){this.state=Ta,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")},t.prototype.reverse=function(){this.state=Ma,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")},t.prototype.seek=function(t){this.pause(),this._time=t,this.update(),this.fire("onSeek")},t.prototype.reset=function(){this.pause(),this._time=0,this.update(),this.fire("onReset")},t.prototype.finish=function(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")},t.prototype.update=function(){this.setPosition(this.getPosition(this._time))},t.prototype.onEnterFrame=function(){var t=this.getTimer()-this._startTime;this.state===Ta?this.setTime(t):this.state===Ma&&this.setTime(this.duration-t)},t.prototype.pause=function(){this.state=xd,this.fire("onPause")},t.prototype.getTimer=function(){return new Date().getTime()},t}(),Xa=function(){function t(e){var i,n,r=this,s=e.node,o=s._id,a=e.easing||C.Linear,h=!!e.yoyo;i=void 0===e.duration?.3:0===e.duration?.001:e.duration,this.node=s,this._id=Ad++;var u=s.getLayer()||(s instanceof d.Stage?s.getLayers():null);for(n in u||b.error("Tween constructor have `node` that is not in a layer. Please add node into layer first."),this.anim=new Ja(function(){r.tween.onEnterFrame()},u),this.tween=new Cd(n,function(t){r._tweenFunc(t)},a,0,1,1e3*i,h),this._addListeners(),t.attrs[o]||(t.attrs[o]={}),t.attrs[o][this._id]||(t.attrs[o][this._id]={}),t.tweens[o]||(t.tweens[o]={}),e)void 0===wd[n]&&this._addAttr(n,e[n]);this.reset(),this.onFinish=e.onFinish,this.onReset=e.onReset}return t.prototype._addAttr=function(e,i){var n,r,s,o,a,h,u,$,v=this.node,p=v._id;if((s=t.tweens[p][e])&&delete t.attrs[p][s][e],n=v.getAttr(e),b._isArray(i)){if(r=[],a=Math.max(i.length,n.length),"points"===e&&i.length!==n.length&&(i.length>n.length?(u=n,n=b._prepareArrayForTween(n,i,v.closed())):(h=i,i=b._prepareArrayForTween(i,n,v.closed()))),0===e.indexOf("fill")){for(o=0;o<a;o++)if(o%2==0)r.push(i[o]-n[o]);else{var c=b.colorToRGBA(n[o]);$=b.colorToRGBA(i[o]),n[o]=c,r.push({r:$.r-c.r,g:$.g-c.g,b:$.b-c.b,a:$.a-c.a})}}else for(o=0;o<a;o++)r.push(i[o]-n[o]);}else-1!==Cb.indexOf(e)?(n=b.colorToRGBA(n),r={r:($=b.colorToRGBA(i)).r-n.r,g:$.g-n.g,b:$.b-n.b,a:$.a-n.a}):r=i-n;t.attrs[p][this._id][e]={start:n,diff:r,end:i,trueEnd:h,trueStart:u},t.tweens[p][e]=this._id},t.prototype._tweenFunc=function(e){var i,n,r,s,o,a,h,u,$=this.node,v=t.attrs[$._id][this._id];for(i in v){if(r=(n=v[i]).start,s=n.diff,u=n.end,b._isArray(r)){if(o=[],h=Math.max(r.length,u.length),0===i.indexOf("fill"))for(a=0;a<h;a++)a%2==0?o.push((r[a]||0)+s[a]*e):o.push("rgba("+Math.round(r[a].r+s[a].r*e)+","+Math.round(r[a].g+s[a].g*e)+","+Math.round(r[a].b+s[a].b*e)+","+(r[a].a+s[a].a*e)+")");else for(a=0;a<h;a++)o.push((r[a]||0)+s[a]*e);}else o=-1!==Cb.indexOf(i)?"rgba("+Math.round(r.r+s.r*e)+","+Math.round(r.g+s.g*e)+","+Math.round(r.b+s.b*e)+","+(r.a+s.a*e)+")":r+s*e;$.setAttr(i,o)}},t.prototype._addListeners=function(){var e=this;this.tween.onPlay=function(){e.anim.start()},this.tween.onReverse=function(){e.anim.start()},this.tween.onPause=function(){e.anim.stop()},this.tween.onFinish=function(){var i=e.node,n=t.attrs[i._id][e._id];n.points&&n.points.trueEnd&&i.setAttr("points",n.points.trueEnd),e.onFinish&&e.onFinish.call(e)},this.tween.onReset=function(){var i=e.node,n=t.attrs[i._id][e._id];n.points&&n.points.trueStart&&i.points(n.points.trueStart),e.onReset&&e.onReset()}},t.prototype.play=function(){return this.tween.play(),this},t.prototype.reverse=function(){return this.tween.reverse(),this},t.prototype.reset=function(){return this.tween.reset(),this},t.prototype.seek=function(t){return this.tween.seek(1e3*t),this},t.prototype.pause=function(){return this.tween.pause(),this},t.prototype.finish=function(){return this.tween.finish(),this},t.prototype.destroy=function(){var e,i=this.node._id,n=this._id,r=t.tweens[i];for(e in this.pause(),r)delete t.tweens[i][e];delete t.attrs[i][n]},t.attrs={},t.tweens={},t}(),ya=Xa;wa.Tween=ya,j.prototype.to=function(t){var e=t.onFinish;t.node=this,t.onFinish=function(){this.destroy(),e&&e()},new Xa(t).play()};var C={BackEaseIn:function(t,e,i,n){var r=1.70158;return i*(t/=n)*t*((r+1)*t-r)+e},BackEaseOut:function(t,e,i,n){var r=1.70158;return i*((t=t/n-1)*t*((r+1)*t+r)+1)+e},BackEaseInOut:function(t,e,i,n){var r=1.70158;return(t/=n/2)<1?i/2*(t*t*((1+(r*=1.525))*t-r))+e:i/2*((t-=2)*t*((1+(r*=1.525))*t+r)+2)+e},ElasticEaseIn:function(t,e,i,n,r,s){var o=0;return 0===t?e:1==(t/=n)?e+i:(s||(s=.3*n),!r||r<Math.abs(i)?(r=i,o=s/4):o=s/(2*Math.PI)*Math.asin(i/r),-r*Math.pow(2,10*(t-=1))*Math.sin((t*n-o)*(2*Math.PI)/s)+e)},ElasticEaseOut:function(t,e,i,n,r,s){var o=0;return 0===t?e:1==(t/=n)?e+i:(s||(s=.3*n),!r||r<Math.abs(i)?(r=i,o=s/4):o=s/(2*Math.PI)*Math.asin(i/r),r*Math.pow(2,-10*t)*Math.sin((t*n-o)*(2*Math.PI)/s)+i+e)},ElasticEaseInOut:function(t,e,i,n,r,s){var o=0;return 0===t?e:2==(t/=n/2)?e+i:(s||(s=n*(.3*1.5)),!r||r<Math.abs(i)?(r=i,o=s/4):o=s/(2*Math.PI)*Math.asin(i/r),t<1?r*Math.pow(2,10*(t-=1))*Math.sin((t*n-o)*(2*Math.PI)/s)*-.5+e:r*Math.pow(2,-10*(t-=1))*Math.sin((t*n-o)*(2*Math.PI)/s)*.5+i+e)},BounceEaseOut:function(t,e,i,n){return(t/=n)<1/2.75?i*(7.5625*t*t)+e:t<2/2.75?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e},BounceEaseIn:function(t,e,i,n){return i-C.BounceEaseOut(n-t,0,i,n)+e},BounceEaseInOut:function(t,e,i,n){return t<n/2?.5*C.BounceEaseIn(2*t,0,i,n)+e:.5*C.BounceEaseOut(2*t-n,0,i,n)+.5*i+e},EaseIn:function(t,e,i,n){return i*(t/=n)*t+e},EaseOut:function(t,e,i,n){return-i*(t/=n)*(t-2)+e},EaseInOut:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},StrongEaseIn:function(t,e,i,n){return i*(t/=n)*t*t*t*t+e},StrongEaseOut:function(t,e,i,n){return i*((t=t/n-1)*t*t*t*t+1)+e},StrongEaseInOut:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t*t*t+e:i/2*((t-=2)*t*t*t*t+2)+e},Linear:function(t,e,i,n){return i*t/n+e}};wa.Easings=C;var Db=function(){function e(i,t){Fd(this,e),v(this,"images",[]),v(this,"firstPlay",!0),v(this,"firstIndex",0),v(this,"frames",[]),v(this,"stage",void 0),v(this,"layer",void 0),this.images=t,this.firstIndex=t.findIndex(function(e){return e.first}),this.stage=new Na({container:i instanceof Node?i:document.querySelector(i),width:this.dimension.width,height:this.dimension.height}),this.layer=new Za,this.stage.add(this.layer);var r=0,a=this;this.images.forEach(function(e,i){a.frames.push(new Sa({width:a.dimension.width,height:a.dimension.height,opacity:Number(a.firstIndex>0?i<=a.firstIndex:0===i)})),a.layer.add(a.frames[i]);var t=new window.Image;t.onload=function(){a.frames[i].image(t),a.layer.draw(),++r===a.totalImage&&a.run()},t.src=e.src}),window.onresize=Dd(this.windowResized.bind(this),250)}return Ed(e,[{key:"restart",value:function(){var e=this;this.frames.forEach(function(i,t){0!==t&&(e.images[0].fade?new ya({node:i,duration:e.images[0].tween||.2,opacity:0}).play():i.opacity(0))}),this.images[0].fade||this.layer.draw(),this.run()}},{key:"show",value:function(e){if(!this.images[e].fade)return this.frames[e].opacity(1),void this.layer.draw();new ya({node:this.frames[e],duration:this.images[e].tween||.2,opacity:1}).play()}},{key:"windowResized",value:function(){this.stage.size(this.dimension);var e=this;this.frames.forEach(function(i){i.size(e.dimension)}),this.layer.draw()}},{key:"run",value:function(){var e=0,i=this;this.images.forEach(function(t,r){i.firstPlay&&i.firstIndex>0&&r<i.firstIndex||(i.firstPlay=!1,e+=1e3*t.duration,setTimeout(function(){r===i.totalImage-1?i.restart():i.show(r+1)},e))})}},{key:"totalImage",get:function(){return this.images.length}},{key:"dimension",get:function(){var e=window.innerWidth,i=window.innerHeight;return e>i&&(e=i),e<i&&(i=e),{width:e,height:i}}}]),e}();_.default=Db,_=Db;if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=_}else if(typeof define==="function"&&define.amd){define(function(){return _})}else{this["BannerPlayer"]=_}})();